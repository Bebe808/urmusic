function isNullOrUndef(a){return null===a||void 0===a}function EnumerationValue(a,b){this.name=b,this.ownerEnum=a}function Enumeration(a){if(!Array.isArray(a))throw new Error("No values specified for the Enumeration");for(var b=0;b<a.length;b++)this[a[b]]=new EnumerationValue(this,a[b])}function numberProperty(a){a||(a=0),"object"==typeof a&&a.hasOwnProperty("expr")&&(a=a.expr);var b=a.toString(),c=new Function(exprArgs.join(","),"return ("+b+")"),d={};return d.toJSON=function(){return b},Object.defineProperty(d,"value",{get:function(){try{return c(Math.random,Math.max,Math.min,Math.cos,Math.sin,Math.tan,Math.acos,Math.asin,Math.atan,Math.pow,Math.PI,frameProps.maxval,frameProps.minval,frameProps.time,frameProps.duration,frameProps.maxlowval,frameProps.minlowval,frameProps.maxhighval,frameProps.minhighval)}catch(a){return 0}}}),Object.defineProperty(d,"expr",{get:function(){return b},set:function(a){""===a&&(a="0"),b=a,c=new Function(exprArgs.join(","),"return ("+b.toLowerCase()+")")}}),d}function AdvancedSettings(a){this.set(a)}function Section(a){a=a||{},this.name=isNullOrUndef(a.name)?"A section":a.name,this.visible=!!isNullOrUndef(a.visible)||a.visible,this.minDecibels=numberProperty(isNullOrUndef(a.minDecibels)?-100:a.minDecibels),this.maxDecibels=numberProperty(isNullOrUndef(a.maxDecibels)?-20:a.maxDecibels),this.barCount=numberProperty(isNullOrUndef(a.barCount)?32:a.barCount),this.freqStart=numberProperty(isNullOrUndef(a.freqStart)?0:a.freqStart),this.freqEnd=numberProperty(isNullOrUndef(a.freqEnd)?.03:a.freqEnd),this.barsWidth=numberProperty(isNullOrUndef(a.barsWidth)?6:a.barsWidth),this.barsStartX=numberProperty(isNullOrUndef(a.barsStartX)?-1:a.barsStartX),this.barsEndX=numberProperty(isNullOrUndef(a.barsEndX)?1:a.barsEndX),this.barsY=numberProperty(isNullOrUndef(a.barsY)?-.5:a.barsY),this.color=isNullOrUndef(a.color)?"#ffffff":a.color,this.barsPow=numberProperty(isNullOrUndef(a.barsPow)?2:a.barsPow),this.barsHeight=numberProperty(isNullOrUndef(a.barsHeight)?.7:a.barsHeight),this.barsMinHeight=numberProperty(isNullOrUndef(a.barsMinHeight)?.01:a.barsMinHeight),this.glowness=numberProperty(isNullOrUndef(a.glowness)?0:a.glowness),this.polar=numberProperty(isNullOrUndef(a.polar)?0:a.polar),this.mode=isNullOrUndef(a.mode)?drawMode.LINES:drawMode[a.mode],this.clampShapeToZero=!!isNullOrUndef(a.clampShapeToZero)||a.clampShapeToZero,this.closeShape=!!isNullOrUndef(a.closeShape)||a.closeShape,this.smartFill=!isNullOrUndef(a.smartFill)&&a.smartFill,this.drawLast=!!isNullOrUndef(a.drawLast)||a.drawLast,this.quadratic=!!isNullOrUndef(a.quadratic)||a.quadratic}function Settings(a){this.set(a)}function loadFilePreset(a,b){if(a){var c=a.name.substr(0,a.name.lastIndexOf(".")),d=new FileReader;d.onload=function(a){for(var d=new Settings(JSON.parse(a.target.result)),e=c,f=0;void 0!==settingsPresets[e];)e=c+" ("+f+")",f++;settingsPresets[e]=d,b&&loadPreset(e)},d.readAsText(a)}}function loadPreset(a){if(isNullOrUndef(a)){var b=[];for(var c in settingsPresets)b.push(c);a=b[Math.floor(Math.random()*b.length)]}settings.set(settingsPresets[a]),refreshControls()}Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(a,b){var c=this[a],d=c,e=function(){return d},f=function(e){return c=d,d=b.call(this,a,c,e)};delete this[a]&&Object.defineProperty(this,a,{get:e,set:f,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(a){var b=this[a];delete this[a],this[a]=b}}),EnumerationValue.prototype.toJSON=function(){return this.name},EnumerationValue.prototype.toString=EnumerationValue.prototype.toJSON;var AudioContext=window.AudioContext||window.webkitAudioContext,drawMode=new Enumeration(["LINES","FILL","OUTLINE"]),refreshables={SETTINGS_BIT:1,TABS_BIT:2,PRESETLIST_BIT:4},exprArgs=["rand","max","min","cos","sin","tan","acos","asin","atan","pow","pi","maxval","minval","time","duration","maxlowval","minlowval","maxhighval","minhighval"];AdvancedSettings.prototype.set=function(a){a=a||{},this.enableLowpass=!isNullOrUndef(a.enableLowpass)&&a.enableLowpass,this.enableHighpass=!isNullOrUndef(a.enableHighpass)&&a.enableHighpass,this.lowpassFreq=isNullOrUndef(a.lowpassFreq)?120:a.lowpassFreq,this.highpassFreq=isNullOrUndef(a.highpassFreq)?480:a.highpassFreq},Settings.prototype.addSection=function(a){return this.sections.push(new Section(a)),this},Settings.prototype.set=function(a){if(a=a||{},this.smoothingTimeConstant=numberProperty(isNullOrUndef(a.smoothingTimeConstant)?.65:a.smoothingTimeConstant),this.sections=[],Array.isArray(a.sections))for(var b=0;b<a.sections.length;b++)this.addSection(a.sections[b]);this.globalScale=numberProperty(isNullOrUndef(a.globalScale)?1:a.globalScale),this.globalOffsetX=numberProperty(isNullOrUndef(a.globalOffsetX)?0:a.globalOffsetX),this.globalOffsetY=numberProperty(isNullOrUndef(a.globalOffsetY)?0:a.globalOffsetY),this.globalRotation=numberProperty(isNullOrUndef(a.globalRotation)?0:a.globalRotation),this.imageURL=isNullOrUndef(a.imageURL)?"":a.imageURL,this.imageX=numberProperty(isNullOrUndef(a.imageX)?0:a.imageX),this.imageY=numberProperty(isNullOrUndef(a.imageY)?0:a.imageY),this.imageWidth=numberProperty(isNullOrUndef(a.imageWidth)?.4:a.imageWidth),this.imageHeight=numberProperty(isNullOrUndef(a.imageHeight)?.4:a.imageHeight),this.imageRot=numberProperty(isNullOrUndef(a.imageRot)?0:a.imageRot),this.backgroundColor=isNullOrUndef(a.backgroundColor)?"#3b3b3b":a.backgroundColor,this.advanced?this.advanced.set(a.advanced):this.advanced=new AdvancedSettings(a.advanced)};var settingsPresets={Default:(new Settings).addSection(),DubstepGutter:new Settings(JSON.parse('{"smoothingTimeConstant":"0.5","sections":[{"name":"Bass top","visible":true,"minDecibels":"-70","maxDecibels":"-30","barCount":"128","freqStart":"-0.002","freqEnd":"0.02","barsWidth":"1","barsStartX":"-0.55","barsEndX":"0.1","barsY":"0.2","color":"#ffffff","barsPow":"5","barsHeight":"0.05","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"LINES","clampShapeToZero":true,"closeShape":true,"smartFill":false,"drawLast":true,"quadratic":true},{"name":"Bass bottom","visible":true,"minDecibels":"-70","maxDecibels":"-30","barCount":"128","freqStart":"-0.002","freqEnd":"0.02","barsWidth":"1","barsStartX":"0.65","barsEndX":"0.1","barsY":"0.2","color":"#ffffff","barsPow":"5","barsHeight":"0.05","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"LINES","clampShapeToZero":true,"closeShape":true,"smartFill":false,"drawLast":false,"quadratic":true},{"name":"High top","visible":true,"minDecibels":"-70","maxDecibels":"-30","barCount":"128","freqStart":"0.02","freqEnd":"0.035","barsWidth":"1","barsStartX":"1.45","barsEndX":"1.05","barsY":"0.2","color":"#ffffff","barsPow":"3","barsHeight":"0.03","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"LINES","clampShapeToZero":true,"closeShape":true,"smartFill":false,"drawLast":true,"quadratic":true},{"name":"High bottom","visible":true,"minDecibels":"-70","maxDecibels":"-30","barCount":"128","freqStart":"0.02","freqEnd":"0.035","barsWidth":"1","barsStartX":"0.65","barsEndX":"1.05","barsY":"0.2","color":"#ffffff","barsPow":"3","barsHeight":"0.03","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"LINES","clampShapeToZero":true,"closeShape":true,"smartFill":false,"drawLast":true,"quadratic":true}],"globalScale":"max(max((maxlowval + 70) / 50, 0) * 3.8, 1.5)","globalOffsetX":"rand() * max((maxlowval + 70) / 50, 0) * 0.01 - 0.005","globalOffsetY":"rand() * max((maxlowval + 70) / 50, 0) * 0.01 - 0.005","globalRotation":"0","imageURL":"dsg.png","imageX":"0","imageY":"0","imageWidth":"0.405","imageHeight":"0.405","imageRot":"0","backgroundColor":"#3b3b3b","advanced":{"enableLowpass":true,"enableHighpass":false,"lowpassFreq":20,"highpassFreq":480}}')),"Drop the Bassline":new Settings(JSON.parse('{"smoothingTimeConstant":"0.5","sections":[{"name":"A section","visible":true,"minDecibels":"-48","maxDecibels":"-20","barCount":"128","freqStart":"0","freqEnd":"0.015","barsWidth":"0.8","barsStartX":"-0.5","barsEndX":"0.5","barsY":"0.4","color":"#ffffff","barsPow":"3","barsHeight":"0.23","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"FILL","clampShapeToZero":false,"closeShape":false,"smartFill":true,"drawLast":true,"quadratic":true},{"name":"A section","visible":true,"minDecibels":"-48","maxDecibels":"-20","barCount":"128","freqStart":"0","freqEnd":"0.015","barsWidth":"0.8","barsStartX":"1.5","barsEndX":"0.5","barsY":"0.4","color":"#ffffff","barsPow":"3","barsHeight":"0.23","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"FILL","clampShapeToZero":false,"closeShape":false,"smartFill":true,"drawLast":true,"quadratic":true},{"name":"A section","visible":true,"minDecibels":"-48","maxDecibels":"-20","barCount":"128","freqStart":"0","freqEnd":"0.015","barsWidth":"0.8","barsStartX":"-0.5","barsEndX":"0.5","barsY":"0.4","color":"#ff0000","barsPow":"3","barsHeight":"0.19","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"FILL","clampShapeToZero":false,"closeShape":false,"smartFill":true,"drawLast":true,"quadratic":true},{"name":"A section","visible":true,"minDecibels":"-48","maxDecibels":"-20","barCount":"128","freqStart":"0","freqEnd":"0.015","barsWidth":"0.8","barsStartX":"1.5","barsEndX":"0.5","barsY":"0.4","color":"#ff0000","barsPow":"3","barsHeight":"0.19","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"FILL","clampShapeToZero":false,"closeShape":false,"smartFill":true,"drawLast":true,"quadratic":true},{"name":"A section","visible":true,"minDecibels":"-48","maxDecibels":"-20","barCount":"128","freqStart":"0","freqEnd":"0.015","barsWidth":"0.8","barsStartX":"-0.5","barsEndX":"0.5","barsY":"0.4","color":"#ffffff","barsPow":"3","barsHeight":"0.15","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"FILL","clampShapeToZero":false,"closeShape":false,"smartFill":true,"drawLast":true,"quadratic":true},{"name":"A section","visible":true,"minDecibels":"-48","maxDecibels":"-20","barCount":"128","freqStart":"0","freqEnd":"0.015","barsWidth":"0.8","barsStartX":"1.5","barsEndX":"0.5","barsY":"0.4","color":"#ffffff","barsPow":"3","barsHeight":"0.15","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"FILL","clampShapeToZero":false,"closeShape":false,"smartFill":true,"drawLast":true,"quadratic":true}],"globalScale":"max(max((maxlowval + 70) / 50, 0) * 1.2, 0.8)","globalOffsetX":"rand() * max((maxlowval + 70) / 50, 0) * 0.01 - 0.005","globalOffsetY":"rand() * max((maxlowval + 70) / 50, 0) * 0.01 - 0.005","globalRotation":"0","imageURL":"","imageX":"0","imageY":"0","imageWidth":"0.8","imageHeight":"0.8","imageRot":"0","backgroundColor":"#3b3b3b","advanced":{"enableLowpass":true,"enableHighpass":false,"lowpassFreq":"100","highpassFreq":480}}')),BOD:new Settings(JSON.parse('{"smoothingTimeConstant":"0.65","sections":[{"name":"A section","visible":true,"minDecibels":"-65","maxDecibels":"-10","barCount":"256","freqStart":"0","freqEnd":"0.1","barsWidth":"0.5","barsStartX":"-1","barsEndX":"1","barsY":"0.2","color":"#ff0000","barsPow":"3","barsHeight":"-1","barsMinHeight":"-0.002","glowness":"64","polar":"0","mode":"LINES","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true}],"globalScale":"1","globalOffsetX":"0","globalOffsetY":"0","globalRotation":"0","imageURL":"","imageX":"0","imageY":"0","imageWidth":"0.4","imageHeight":"0.4","imageRot":"0","backgroundColor":"#000000"}'))},settings=new Settings,frameProps={maxval:0,minval:Number.MIN_SAFE_INTEGER,maxlowval:0,minlowval:Number.MIN_SAFE_INTEGER,maxhighval:0,minhighval:Number.MIN_SAFE_INTEGER},refreshControls=function(){var a=null,b=null,c=null,d=null,e=null,f=null,g=null,h=null,i=null,j=null,k=null,l=!1,m=[],n=function(){for(var a=-1,b=0;b<c.children.length;b++)c.children[b].classList.contains("activated")&&(a=b);for(;0!==e.children.length;)e.removeChild(e.children[0]);for(;0!==c.children.length&&c.children[0]!==d;)c.removeChild(c.children[0]);for(var b=0;b<settings.sections.length;b++)t(b);if(a!==-1){for(var b=0;b<m[a].length;b++)e.appendChild(m[a][b]);c.children[a].classList.add("activated")}},o=function(a,b){var c=a[b];if("object"==typeof c&&!c.hasOwnProperty("expr")||"function"==typeof c)return null;var d=document.createElement("li"),e=document.createElement("span"),f=document.createElement("input");if(d.classList.add("settingsCtrl"),e.classList.add("ctrlName"),f.classList.add("ctrlInput"),e.innerHTML=b,"boolean"==typeof c)f.type="checkbox",f.checked=c;else if(b.toLowerCase().endsWith("color"))f.type="color",f.value=c.toString();else{f.type="text",f.placeholder=c.hasOwnProperty("expr")?"expression":typeof c;var g=c.toString();c.hasOwnProperty("expr")?f.value=c.expr:g.startsWith("data:")?f.value="DataURL":f.value=c.toString()}if(f.addEventListener("change",function(){if("number"==typeof a[b]){if(""===this.value)return;a[b]=this.value}else"boolean"==typeof a[b]?a[b]=this.checked:a[b].hasOwnProperty("expr")?a[b].expr=this.value:a[b]=this.value}),d.appendChild(e),d.appendChild(f),"boolean"==typeof c){var h=document.createElement("span");h.classList.add("ctrlCheckbox","fa"),h.addEventListener("click",function(c){a[b]=f.checked=!f.checked}),d.appendChild(h)}return d},p=function(a,b,c){var e=(a[b],document.createElement("li")),f=document.createElement("span"),g=document.createElement("select");e.classList.add("settingsCtrl"),f.classList.add("ctrlName"),g.classList.add("ctrlInput"),f.innerHTML=b;for(var h in c){var i=document.createElement("option");i.value=h,i.innerHTML=h,g.appendChild(i),a[b]===c[h]&&(g.value=h)}return g.addEventListener("change",function(){var d=c[this.value];a[b]=d}),e.appendChild(f),e.appendChild(g),e},q=function(a,b){var d=a[b],e=document.createElement("li"),f=document.createElement("input"),g=document.createElement("ul");e.classList.add("settingsMajorCtrl"),f.classList.add("ctrlMajorInput"),g.classList.add("ctrlOptions"),f.type="text",f.placeholder=b,f.value=d.toString();var h=document.createElement("li"),i=document.createElement("li"),j=document.createElement("li");h.classList.add("fa","fa-clone","w3-large","ctrlOptClone"),i.classList.add("fa","fa-trash-o","w3-large","ctrlOptDelete");var k=document.createElement("i"),l=document.createElement("i");return k.classList.add("fa","fa-angle-right","w3-small","ctrlOptRight"),l.classList.add("fa","fa-angle-left","w3-small","ctrlOptLeft"),j.classList.add("ctrlOptMoves"),j.appendChild(k),j.appendChild(document.createElement("br")),j.appendChild(l),k.addEventListener("click",function(){var b=settings.sections.indexOf(a);if(!(b>=settings.sections.length-1)){var d=settings.sections[b];settings.sections[b]=settings.sections[b+1],settings.sections[b+1]=d,n(),c.children[b+1].click()}}),l.addEventListener("click",function(){var b=settings.sections.indexOf(a);if(!(b<=0)){var d=settings.sections[b];settings.sections[b]=settings.sections[b-1],settings.sections[b-1]=d,n(),c.children[b-1].click()}}),h.addEventListener("click",function(){var b=new Section(a);settings.sections.push(b),t(settings.sections.length-1)}),i.addEventListener("click",function(){var b=settings.sections.indexOf(a);settings.sections.splice(b,1),u(b)}),g.appendChild(j),g.appendChild(h),g.appendChild(i),f.addEventListener("change",function(){a[b]=this.value,c.children[settings.sections.indexOf(a)].title=a[b]}),e.appendChild(f),e.appendChild(g),e},r=function(a){var b=[];for(var c in a){var d=null;d=a[c]instanceof EnumerationValue?p(a,c,a[c].ownerEnum):"name"===c?q(a,c):o(a,c),d&&b.push(d)}return b},s=function(a){if(this!==d&&!this.classList.contains("activated")){for(var b=-1,f=0;f<settings.sections.length;f++)c.children[f]!==this?c.children[f].classList.contains("activated")&&c.children[f].classList.remove("activated"):b=f;for(this.classList.add("activated");0!==e.children.length;)e.removeChild(e.children[0]);for(var f=0;f<m[b].length;f++)e.appendChild(m[b][f])}},t=function(a){var b=document.createElement("li");b.innerHTML=a.toString(),b.title=settings.sections[a].name,b.classList.add("sectionTab"),b.addEventListener("click",s),c.insertBefore(b,d),m[a]=r(settings.sections[a])},u=function(a){var b=c.children[a];b&&(b.removeEventListener("click",s),c.removeChild(b),n())},v=function(){for(;0!==a.children.length;)a.removeChild(a.children[0]);for(var c in settings){var d=o(settings,c);d&&a.appendChild(d)}for(;0!==b.children.length;)b.removeChild(b.children[0]);for(var c in settings.advanced){var d=o(settings.advanced,c);d&&b.appendChild(d)}},w=function(){for(;0!==f.children.length;)f.removeChild(f.children[0]);for(var a in settingsPresets){var b=document.createElement("li");b.innerHTML=a.toString(),b.addEventListener("click",function(){var b=a;return function(){loadPreset(b),n()}}()),f.appendChild(b)}};return function(m){0!==m&&(m||(m=refreshables.SETTINGS_BIT|refreshables.TABS_BIT|refreshables.PRESETLIST_BIT),a||(a=document.getElementById("globalSettings")),b||(b=document.getElementById("advancedSettings")),c||(c=document.getElementById("settingsSectionTabs")),d||(d=document.getElementById("addTab")),e||(e=document.getElementById("sectionSettings")),f||(f=document.getElementById("settingsPresetsList")),g||(g=document.getElementById("presetNameInput")),h||(h=document.getElementById("settingsPresetsOptOpen")),i||(i=document.getElementById("settingsPresetsOptSave")),j||(j=document.getElementById("downloader")),k||(k=document.getElementById("fileChooser")),l||(d.addEventListener("click",function(a){var b=new Section;settings.sections.push(b),t(settings.sections.length-1)}),k.addEventListener("change",function(a){for(var b=0;b<a.target.files.length-1;b++)loadFilePreset(a.target.files[b]);loadFilePreset(a.target.files[a.target.files.length-1],!0)}),h.addEventListener("click",function(a){k.accept=".urm",k.click()}),i.addEventListener("click",function(a){var b=g.value?g.value:"untitled";j.href="data:text/plain;base64,"+btoa(JSON.stringify(settings)),j.download=b+".urm",j.click();for(var c=0;void 0!==settingsPresets[b];)b=(g.value?g.value:"untitled")+" ("+c+")",c++;settingsPresets[b]=new Settings(settings),v(),n(),w()}),l=!0),0!==(m&refreshables.SETTINGS_BIT)&&v(),0!==(m&refreshables.TABS_BIT)&&n(),0!==(m&refreshables.PRESETLIST_BIT)&&w(),c.children[0]&&s.call(c.children[0]))}}();window.onload=function(){function u(a){if(a.type.match("image.*")){var b=new FileReader;b.addEventListener("load",function(a){settings.imageURL=a.target.result,refreshControls(refreshables.SETTINGS_BIT)}),b.readAsDataURL(a)}}function v(a){if(a.type.match("audio.*")){var b=new FileReader,c=a.name.substr(0,a.name.lastIndexOf("."));document.title="Urmusic - "+c,b.addEventListener("load",function(a){q.src=a.target.result,q.play()}),b.readAsDataURL(a),r.classList.contains("masked")||r.classList.add("masked")}}function w(a){for(var b,c,d=0;d<a.length;d++)a[d].type.match("image.*")?b=a[d]:a[d].type.match("audio.*")?c=a[d]:a[d].name.endsWith(".urm")&&loadFilePreset(a[d],d===a.length-1);b&&u(b),c&&v(c)}function x(a,b,c){return a+c*(b-a)}function y(a,b,c){return b<0||b>=a.length?c:a[b]}function z(a,b,c,d){if(c){var e=Math.floor(b+.5);return C(x(y(a,e-1,d),y(a,e,d),.5),y(a,e,d),x(y(a,e,d),y(a,e+1,d),.5),b-e+.5)}var f=Math.floor(b),g=Math.ceil(b),h=y(a,f,d),i=y(a,g,d);return x(h,i,b-f)}function A(a){var b={};for(var c in a){var d=a[c];"object"==typeof d&&d.hasOwnProperty("expr")?b[c]=d.value:b[c]=d}return b}function B(a,b){return Math.max(z(h,x(b.freqStart,b.freqEnd,a)*h.length,b.quadratic,b.minDecibels)-b.minDecibels,0)/(b.maxDecibels-b.minDecibels)}function C(a,b,c,d){var e=(1-d)*(1-d)*a+2*(1-d)*d*b+d*d*c;return e}function D(){if(g.smoothingTimeConstant=settings.smoothingTimeConstant.value,j.smoothingTimeConstant=settings.smoothingTimeConstant.value,m.smoothingTimeConstant=settings.smoothingTimeConstant.value,!h&&(h=new Float32Array(g.frequencyBinCount),q.paused))for(var c=0;c<h.length;c++)h[c]=Number.MIN_SAFE_INTEGER;if(settings.advanced.enableLowpass&&!k&&(k=new Float32Array(j.frequencyBinCount),q.paused))for(var c=0;c<k.length;c++)k[c]=Number.MIN_SAFE_INTEGER;if(settings.advanced.enableHighpass&&!n&&(n=new Float32Array(m.frequencyBinCount),q.paused))for(var c=0;c<n.length;c++)n[c]=Number.MIN_SAFE_INTEGER;q.paused||(g.getFloatFrequencyData(h),settings.advanced.enableLowpass&&j.getFloatFrequencyData(k),settings.advanced.enableHighpass&&m.getFloatFrequencyData(n)),b.width==b.clientWidth&&b.height==b.clientHeight||(b.width=b.clientWidth,b.height=b.clientHeight),frameProps.minval=Math.min.apply(Math,h),frameProps.maxval=Math.max.apply(Math,h),frameProps.time=q.currentTime,frameProps.duration=q.duration,settings.advanced.enableLowpass&&(frameProps.maxlowval=Math.max.apply(Math,k),frameProps.minlowval=Math.min.apply(Math,k)),settings.advanced.enableHighpass&&(frameProps.maxhighval=Math.max.apply(Math,n),frameProps.minhighval=Math.min.apply(Math,n)),G(),a(D)}function E(a,b,c,d){var e=x(c.barsStartX,c.barsEndX,d),f=c.barsY;if(c.polar>0){var g=Math.cos((.5*e+.5)*Math.PI*2),h=Math.sin((.5*e+.5)*Math.PI*2),i=g*f,j=h*f;e=x(e*a,i*a,c.polar),f=x(f*b,j*b,c.polar)}else e*=a,f*=b;return{x:e,y:f}}function F(a,b,c,d){var e=Math.pow(B(d,c),c.barsPow)*c.barsHeight,f=x(c.barsStartX,c.barsEndX,d),g=c.barsY,h=g+c.barsMinHeight+e,i=f;if(c.polar>0){var j=Math.cos((.5*f+.5)*Math.PI*2),k=Math.sin((.5*f+.5)*Math.PI*2),l=j*g,m=k*g,n=j*h,o=k*h;f=x(f*a,l*a,c.polar),g=x(g*b,m*b,c.polar),i=x(i*a,n*a,c.polar),h=x(h*b,o*b,c.polar)}else f*=a,g*=b,i*=a,h*=b;return{x:f,y:g,ex:i,ey:h}}function G(){var a=b.width/b.height,d=b.width,e=b.height;d>e?d/=a:e*=a,c.clearRect(0,0,b.width,b.height),c.fillStyle=settings.backgroundColor,c.fillRect(0,0,b.width,b.height),c.save(),c.translate(b.width/2,b.height/2),c.scale(.5,-.5);var f=settings.globalScale.value;c.scale(f,f),c.translate(settings.globalOffsetX.value*d,settings.globalOffsetY.value*e),c.rotate(settings.globalRotation.value);for(var g=0;g<settings.sections.length;g++){var h=A(settings.sections[g]),i=h.mode,j=h.barCount;if(h.visible){c.strokeStyle=h.color,c.fillStyle=h.color,c.lineWidth=h.barsWidth/100*Math.min(b.width,b.height),c.shadowColor=h.color,c.shadowBlur=h.glowness*f,c.beginPath();for(var k=0;k<j&&(h.drawLast||k!==j-1);k++){var l=k/(j-1),m=F(d,e,h,l);(i==drawMode.LINES||0==k&&h.clampShapeToZero)&&c.moveTo(m.x,m.y),c.lineTo(m.ex,m.ey),k==j-1&&h.clampShapeToZero&&c.lineTo(m.x,m.y)}if(h.closeShape&&i===drawMode.OUTLINE&&c.closePath(),i===drawMode.FILL){if(h.smartFill)for(var k=j-1;k>=0;k--)if(h.drawLast||k!==j-1){var l=k/(j-1),n=E(d,e,h,l);c.lineTo(n.x,n.y)}c.fill()}else c.stroke()}}if(o){c.shadowColor="rgba(0, 0, 0, 0)",c.shadowBlur=0;var q=settings.imageWidth.value,r=settings.imageHeight.value;c.scale(1,-1),c.rotate(settings.imageRot.value),c.drawImage(p,(settings.imageX.value-q/2)*d,(settings.imageY.value-r/2)*e,q*d,r*e)}c.restore()}function H(){navigator.userAgent.indexOf("Firefox/")===-1&&(s.style.marginRight="0px")}function I(){if(!b||!c||!d)throw alert("Your browser isn't compatible"),new Error("Couldn't initialize");e=d.createMediaElementSource(q),f=d.createGain(),g=d.createAnalyser(),g.fftSize=2048,i=d.createBiquadFilter(),i.type="lowpass",j=d.createAnalyser(),j.fftSize=2048,l=d.createBiquadFilter(),l.type="highpass",m=d.createAnalyser(),m.fftSize=2048,b.width=document.body.clientWidth,b.height=document.body.clientHeight,b.addEventListener("dragover",function(a){a.stopPropagation(),a.preventDefault(),a.dataTransfer.dropEffect="copy"},!1),b.addEventListener("drop",function(a){a.stopPropagation(),a.preventDefault(),w(a.dataTransfer.files)},!1),localStorage.urmusic_volume?q.volume=localStorage.urmusic_volume:localStorage.urmusic_volume=q.volume,q.addEventListener("volumechange",function(a){f.gain.value=0===q.volume?0:1/q.volume,localStorage.urmusic_volume=q.volume}),q.crossOrigin="anonymous";var a=document.getElementById("settingsNav"),h=document.getElementById("presetMenuOpenCloseBtn"),k=document.getElementById("settingsPresetsMenu");document.getElementById("hambParent").addEventListener("click",function(b){a.classList.contains("activated")?a.classList.remove("activated"):a.classList.add("activated"),a.classList.contains("activated")||(k.classList.remove("opened"),h.classList.remove("opened"))}),h.addEventListener("click",function(){this.classList.contains("opened")?(this.classList.remove("opened"),k.classList.remove("opened")):(this.classList.add("opened"),k.classList.add("opened"))}),t.addEventListener("click",function(){s.style.marginRight=""}),f.gain.value=0===q.volume?0:1/q.volume,i.connect(j),l.connect(m),e.connect(f),f.connect(g),f.connect(i),f.connect(l),e.connect(d.destination),p.addEventListener("load",function(){o=!0}),settings.watch("imageURL",function(a,b,c){return o=!1,p.src=c,c}),settings.advanced.watch("lowpassFreq",function(a,b,c){return i.frequency.value=c,c}),settings.advanced.watch("highpassFreq",function(a,b,c){return l.frequency.value=c,c}),settings.advanced.lowpassFreq=settings.advanced.lowpassFreq,settings.advanced.highpassFreq=settings.advanced.highpassFreq,console.log(" _    _ ________     __  _ \n| |  | |  ____\\ \\   / / | |\tHey you! This app is highly customizable through the JavaScript\n| |__| | |__   \\ \\_/ /  | |\tconsole too! Have fun, and try not to broke everything :p!\n|  __  |  __|   \\   /   | |\t\n| |  | | |____   | |    |_|\tUrmusic V1.0.1\n|_|  |_|______|  |_|    (_)\tBy Nasso (https://nasso.github.io/)\n\n"),loadPreset(),D(),H()}var e,f,g,h,i,j,k,l,m,n,a=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||function(a){setTimeout(a,1e3/60)},b=document.getElementById("cvs"),c=b.getContext("2d"),d=new AudioContext,o=!1,p=new Image,q=document.getElementById("audioElement"),r=document.getElementById("helpNav"),s=document.getElementById("firefoxIsBetter"),t=s.getElementsByClassName("close")[0];I()};