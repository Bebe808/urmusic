function isNullOrUndef(e){return null===e||void 0===e}function EnumerationValue(e,t){this.name=t,this.ownerEnum=e}function Enumeration(e){if(!Array.isArray(e))throw new Error("No values specified for the Enumeration");for(var t=0;t<e.length;t++)this[e[t]]=new EnumerationValue(this,e[t])}function NumberProperty(e){e||(e=0),"object"==typeof e&&e.hasOwnProperty("expr")&&(e=e.expr);var t=e.toString(),a=new Function(exprArgs.join(","),"return ("+t+")"),n=+t;Object.defineProperty(this,"value",{get:function(){if(!Number.isNaN(n))return n;try{return a(null,null,null,Math.random,Math.max,Math.min,Math.cos,Math.sin,Math.tan,Math.acos,Math.asin,Math.atan,Math.pow,Math.PI,frameProps.maxval,frameProps.minval,frameProps.time,frameProps.duration,frameProps.maxlowval,frameProps.minlowval,frameProps.maxhighval,frameProps.minhighval,frameProps.csize,frameProps.imgw,frameProps.imgh,frameProps.imgr)}catch(e){return 0}}}),Object.defineProperty(this,"expr",{get:function(){return t},set:function(e){""===e&&(e="0"),t=e,n=+e,Number.isNaN(n)&&(a=new Function(exprArgs.join(","),"return ("+t.toLowerCase()+")"))}})}function AdvancedSettings(e){this.set(e)}function AnalyserSection(e){e=e||{},this.dataCount=new NumberProperty(isNullOrUndef(e.dataCount)?128:e.dataCount),this.lineWidth=new NumberProperty(isNullOrUndef(e.lineWidth)?1:e.lineWidth),this.lineCap=isNullOrUndef(e.lineCap)?lineCapMode.BUTT:lineCapMode[e.lineCap],this.startX=new NumberProperty(isNullOrUndef(e.startX)?-1:e.startX),this.endX=new NumberProperty(isNullOrUndef(e.endX)?1:e.endX),this.yPos=new NumberProperty(isNullOrUndef(e.yPos)?0:e.yPos),this.exponent=new NumberProperty(isNullOrUndef(e.exponent)?1:e.exponent),this.height=new NumberProperty(isNullOrUndef(e.height)?.5:e.height),this.mode=isNullOrUndef(e.mode)?drawMode.LINES:drawMode[e.mode],this.polar=new NumberProperty(isNullOrUndef(e.polar)?0:e.polar),this.clampShapeToZero=!!isNullOrUndef(e.clampShapeToZero)||e.clampShapeToZero,this.closeShape=!!isNullOrUndef(e.closeShape)||e.closeShape,this.drawLast=!!isNullOrUndef(e.drawLast)||e.drawLast,this.quadratic=!!isNullOrUndef(e.quadratic)||e.quadratic}function FreqSection(e){AnalyserSection.call(this,e),e=e||{},this.minDecibels=new NumberProperty(isNullOrUndef(e.minDecibels)?-100:e.minDecibels),this.maxDecibels=new NumberProperty(isNullOrUndef(e.maxDecibels)?-20:e.maxDecibels),this.minHeight=new NumberProperty(isNullOrUndef(e.minHeight)?.01:e.minHeight),this.freqStart=new NumberProperty(isNullOrUndef(e.freqStart)?0:e.freqStart),this.freqEnd=new NumberProperty(isNullOrUndef(e.freqEnd)?.03:e.freqEnd),this.smartFill=!isNullOrUndef(e.smartFill)&&e.smartFill}function TimeDomSection(e){AnalyserSection.call(this,e),e=e||{},this.lineJoin=isNullOrUndef(e.lineJoin)?lineJoinMode.ROUND:lineJoinMode[e.lineJoin]}function ImageSection(e){e=e||{},this.imageURL=isNullOrUndef(e.imageURL)?"":e.imageURL,this.imageBorderRadius=new NumberProperty(isNullOrUndef(e.imageBorderRadius)?0:e.imageBorderRadius);var t=this;this.image=new Image;var a=!1;this.image.onload=function(){a=!0},Object.defineProperty(this,"imageReady",{get:function(){return a}}),this.watch("imageURL",function(e,n,i){return a=!1,t.image.src=i,i}),this.image.src=this.imageURL}function Section(e){e=e||{},this.name=isNullOrUndef(e.name)?"A section":e.name,this.type=isNullOrUndef(e.type)?sectionType.FREQ:sectionType[e.type],this.visible=!!isNullOrUndef(e.visible)||e.visible,this.opacity=new NumberProperty(isNullOrUndef(e.opacity)?1:e.opacity),this.posX=new NumberProperty(isNullOrUndef(e.posX)?0:e.posX),this.posY=new NumberProperty(isNullOrUndef(e.posY)?0:e.posY),this.rotation=new NumberProperty(isNullOrUndef(e.rotation)?0:e.rotation),this.scaleX=new NumberProperty(isNullOrUndef(e.scaleX)?1:e.scaleX),this.scaleY=new NumberProperty(isNullOrUndef(e.scaleY)?1:e.scaleY),this.color=isNullOrUndef(e.color)?"#ffffff":e.color,this.glowness=new NumberProperty(isNullOrUndef(e.glowness)?0:e.glowness),this.target=null,this.type===sectionType.FREQ?this.target=new FreqSection(e.target?e.target:e):this.type===sectionType.TIME_DOM?this.target=new TimeDomSection(e.target?e.target:e):this.type===sectionType.IMAGE&&(this.target=new ImageSection(e.target?e.target:e));var t=this;this.watch("type",function(e,a,n){return a instanceof EnumerationValue&&a.ownerEnum===sectionType&&n!==a?(this.type=n,this.type===sectionType.FREQ?t.target=new FreqSection(t.target):this.type===sectionType.TIME_DOM?t.target=new TimeDomSection(t.target):this.type===sectionType.IMAGE&&(t.target=new ImageSection(t.target)),refreshControls(refreshables.TABS_BIT),n):a})}function Settings(e){this.set(e)}function loadPreset(e){if(isNullOrUndef(e)){var t=[];for(var a in settingsPresets)t.push(a);e=t[Math.floor(Math.random()*t.length)]}settings.set(settingsPresets[e]),refreshControls()}function loadFilePreset(e,t){if(e){var a=e.name.substr(0,e.name.lastIndexOf(".")),n=new FileReader;n.onload=function(e){for(var n=new Settings(JSON.parse(e.target.result)),i=a,s=0;void 0!==settingsPresets[i];)i=a+" ("+s+")",s++;settingsPresets[i]=n,t&&loadPreset(i)},n.readAsText(e)}}Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(e,t){var a=this[e],n=a,i=function(){return n},s=function(i){return a=n,n=t.call(this,e,a,i)};delete this[e]&&Object.defineProperty(this,e,{get:i,set:s,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(e){var t=this[e];delete this[e],this[e]=t}}),CanvasRenderingContext2D.prototype.roundRect=function(e,t,a,n,i){return i=Math.max(i,0),0===i?(this.beginPath(),void this.rect(e,t,a,n)):(a<2*i&&(i=a/2),n<2*i&&(i=n/2),this.beginPath(),this.moveTo(e+i,t),this.arcTo(e+a,t,e+a,t+n,i),this.arcTo(e+a,t+n,e,t+n,i),this.arcTo(e,t+n,e,t,i),this.arcTo(e,t,e+a,t,i),void this.closePath())},EnumerationValue.prototype.toJSON=function(){return this.name},EnumerationValue.prototype.toString=EnumerationValue.prototype.toJSON;var AudioContext=window.AudioContext||window.webkitAudioContext,drawMode=new Enumeration(["LINES","FILL","OUTLINE"]),sectionType=new Enumeration(["FREQ","TIME_DOM","IMAGE"]),lineCapMode=new Enumeration(["BUTT","ROUND","SQUARE"]),lineJoinMode=new Enumeration(["MITER","ROUND","BEVEL"]),refreshables={SETTINGS_BIT:1,TABS_BIT:2,PRESETLIST_BIT:4},exprArgs=["alert","window","navigator","rand","max","min","cos","sin","tan","acos","asin","atan","pow","pi","maxval","minval","time","duration","maxlowval","minlowval","maxhighval","minhighval","csize","imgw","imgh","imgr"],frameProps={maxval:0,minval:Number.MIN_SAFE_INTEGER,maxlowval:0,minlowval:Number.MIN_SAFE_INTEGER,maxhighval:0,minhighval:Number.MIN_SAFE_INTEGER,csize:0,imgw:0,imgh:0,imgr:0};NumberProperty.prototype.toJSON=function(){return this.expr},AdvancedSettings.prototype.set=function(e){e=e||{},this.enableLowpass=!isNullOrUndef(e.enableLowpass)&&e.enableLowpass,this.enableHighpass=!isNullOrUndef(e.enableHighpass)&&e.enableHighpass,this.lowpassFreq=isNullOrUndef(e.lowpassFreq)?120:+e.lowpassFreq,this.highpassFreq=isNullOrUndef(e.highpassFreq)?480:+e.highpassFreq,this.lowpassSmooth=isNullOrUndef(e.lowpassSmooth)?.65:+e.lowpassSmooth,this.highpassSmooth=isNullOrUndef(e.highpassSmooth)?.65:+e.highpassSmooth},Settings.prototype={addSection:function(e){return this.sections.push(new Section(e)),this},set:function(e){if(e=e||{},this.smoothingTimeConstant=new NumberProperty(isNullOrUndef(e.smoothingTimeConstant)?.65:e.smoothingTimeConstant),this.sections=[],Array.isArray(e.sections))for(var t=0;t<e.sections.length;t++)this.addSection(e.sections[t]);this.globalScale=new NumberProperty(isNullOrUndef(e.globalScale)?1:e.globalScale),this.globalOffsetX=new NumberProperty(isNullOrUndef(e.globalOffsetX)?0:e.globalOffsetX),this.globalOffsetY=new NumberProperty(isNullOrUndef(e.globalOffsetY)?0:e.globalOffsetY),this.globalRotation=new NumberProperty(isNullOrUndef(e.globalRotation)?0:e.globalRotation),this.backgroundColor=isNullOrUndef(e.backgroundColor)?"#3b3b3b":e.backgroundColor,this.advanced?this.advanced.set(e.advanced):this.advanced=new AdvancedSettings(e.advanced)}};var settingsPresets={Default:(new Settings).addSection(),"Time domain default":new Settings(JSON.parse('{"smoothingTimeConstant":"0.65","sections":[{"name":"A section","type":"TIME_DOM","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"256","lineWidth":"1","lineCap":"BUTT","polar":"0","lineJoin":"ROUND","startX":"-1","endX":"1","yPos":"0","exponent":"1","height":"0.5","mode":"OUTLINE","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true}}],"globalScale":"1","globalOffsetX":"0","globalOffsetY":"0","globalRotation":"0","backgroundColor":"#3b3b3b","advanced":{"enableLowpass":false,"enableHighpass":false,"lowpassFreq":120,"highpassFreq":480}}')),DubstepGutter:new Settings(JSON.parse('{"smoothingTimeConstant":"0.5","sections":[{"name":"Bass top","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"1","lineCap":"ROUND","startX":"-0.55","endX":"0.1","yPos":"0.2","exponent":"5","height":"0.05","mode":"LINES","polar":"1","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true,"minDecibels":"-70","maxDecibels":"-30","minHeight":"0","freqStart":"-0.002","freqEnd":"0.02","smartFill":false}},{"name":"Bass bottom","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"1","lineCap":"ROUND","startX":"0.65","endX":"0.1","yPos":"0.2","exponent":"5","height":"0.05","mode":"LINES","polar":"1","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true,"minDecibels":"-70","maxDecibels":"-30","minHeight":"0","freqStart":"-0.002","freqEnd":"0.02","smartFill":false}},{"name":"High top","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"1","lineCap":"ROUND","startX":"1.45","endX":"1.05","yPos":"0.2","exponent":"3","height":"0.03","mode":"FILL","polar":"1","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true,"minDecibels":"-70","maxDecibels":"-30","minHeight":"0","freqStart":"0.02","freqEnd":"0.035","smartFill":false}},{"name":"High bottom","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"1","lineCap":"ROUND","startX":"0.65","endX":"1.05","yPos":"0.2","exponent":"3","height":"0.03","mode":"FILL","polar":"1","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true,"minDecibels":"-70","maxDecibels":"-30","minHeight":"0","freqStart":"0.02","freqEnd":"0.035","smartFill":false}},{"name":"Image","type":"IMAGE","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"0.41","scaleY":"0.41","color":"#ffffff","glowness":"0","target":{"imageURL":"dsg.png","imageBorderRadius":"0.5","image":{}}}],"globalScale":"max(max((maxlowval + 70) / 50, 0) * 3.8, 1.5)","globalOffsetX":"rand() * max((maxlowval + 70) / 50, 0) * 0.015 - 0.0075","globalOffsetY":"rand() * max((maxlowval + 70) / 50, 0) * 0.015 - 0.0075","globalRotation":"0","backgroundColor":"#3b3b3b","advanced":{"enableLowpass":true,"enableHighpass":false,"lowpassFreq":20,"highpassFreq":480,"lowpassSmooth":"0.8","highpassSmooth":"0.8"}}')),"Drop the Bassline":new Settings(JSON.parse('{"smoothingTimeConstant":"0.5","sections":[{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"-0.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.23","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"0","freqEnd":"0.015","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"1.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.23","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"0","freqEnd":"0.015","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ff0000","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"-0.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.19","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"0","freqEnd":"0.015","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ff0000","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"1.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.19","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"0","freqEnd":"0.015","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"-0.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.15","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"0","freqEnd":"0.015","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"1.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.15","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"0","freqEnd":"0.015","smartFill":true}},{"name":"A section","type":"IMAGE","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"0.8","scaleY":"0.8","color":"#ffffff","glowness":"0","target":{"imageURL":"dtb.png","imageBorderRadius":"0.5","image":{}}}],"globalScale":"max(max((maxlowval + 70) / 50, 0) * 1.2, 0.8)","globalOffsetX":"rand() * max((maxlowval + 70) / 50, 0) * 0.015 - 0.0075","globalOffsetY":"rand() * max((maxlowval + 70) / 50, 0) * 0.015 - 0.0075","globalRotation":"0","backgroundColor":"#3b3b3b","advanced":{"enableLowpass":true,"enableHighpass":false,"lowpassFreq":100,"highpassFreq":480,"lowpassSmooth":"0.8","highpassSmooth":"0.8"}}')),BOD:new Settings(JSON.parse('{"smoothingTimeConstant":"0.65","sections":[{"name":"A section","visible":true,"minDecibels":"-65","maxDecibels":"-10","dataCount":"256","freqStart":"0","freqEnd":"0.1","lineWidth":"0.5","startX":"-1","endX":"1","yPos":"0.2","color":"#ff0000","exponent":"3","height":"-1","minHeight":"-0.002","glowness":"64","polar":"0","mode":"LINES","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true}],"globalScale":"1","globalOffsetX":"0","globalOffsetY":"0","globalRotation":"0","imageURL":"","imageX":"0","imageY":"0","imageWidth":"0.4","imageHeight":"0.4","imageRot":"0","backgroundColor":"#000000"}'))},settings=new Settings,activeSection=null,refreshControls=function(){var e=null,t=null,a=null,n=null,i=null,s=null,o=null,r=null,l=null,c=null,d=null,u=!1,h=[],p=function(){for(var e=-1,t=0;t<a.children.length;t++)a.children[t].classList.contains("activated")&&(e=t);for(;0!==i.children.length;)i.removeChild(i.children[0]);for(;0!==a.children.length&&a.children[0]!==n;)a.removeChild(a.children[0]);for(var t=0;t<settings.sections.length;t++)w(t);if(e!==-1){for(var t=0;t<h[e].length;t++)i.appendChild(h[e][t]);a.children.length>1?(a.children[Math.min(e,a.children.length-2)].classList.add("activated"),activeSection=settings.sections[Math.min(e,a.children.length-2)]):activeSection=null}else activeSection=null},m=function(e,t){var a=e[t];if(isNullOrUndef(a)&&(a=""),"object"==typeof a&&!a.hasOwnProperty("expr")||"function"==typeof a)return null;var n=document.createElement("li"),i=document.createElement("span"),s=document.createElement("input");if(n.classList.add("settingsCtrl"),i.classList.add("ctrlName"),s.classList.add("ctrlInput"),i.innerHTML=t,"boolean"==typeof a)s.type="checkbox",s.checked=a;else if(t.toLowerCase().endsWith("color"))s.type="color",s.value=a.toString();else{s.type="text",s.placeholder=a instanceof NumberProperty?"expression":typeof a;var o=a.toString();a instanceof NumberProperty?s.value=a.expr:o.startsWith("data:")?s.value="DataURL":s.value=a.toString()}if(s.addEventListener("change",function(){if("number"==typeof e[t]){if(""===this.value)return;e[t]=this.value}else"boolean"==typeof e[t]?e[t]=this.checked:e[t].hasOwnProperty("expr")?e[t].expr=this.value:e[t]=this.value}),n.appendChild(i),n.appendChild(s),"boolean"==typeof a){var r=document.createElement("span");r.classList.add("ctrlCheckbox","fa"),r.addEventListener("click",function(a){e[t]=s.checked=!s.checked}),n.appendChild(r)}return n},f=function(e,t,a){var n=(e[t],document.createElement("li")),i=document.createElement("span"),s=document.createElement("select");n.classList.add("settingsCtrl"),i.classList.add("ctrlName"),s.classList.add("ctrlInput"),i.innerHTML=t;for(var o in a){var r=document.createElement("option");r.value=o,r.innerHTML=o,s.appendChild(r),e[t]===a[o]&&(s.value=o)}return s.addEventListener("change",function(){var n=a[this.value];e[t]=n}),n.appendChild(i),n.appendChild(s),n},g=function(e,t){var n=e[t],i=document.createElement("li"),s=document.createElement("input"),o=document.createElement("ul");i.classList.add("settingsMajorCtrl"),s.classList.add("ctrlMajorInput"),o.classList.add("ctrlOptions"),s.type="text",s.placeholder=t,s.value=n.toString();var r=document.createElement("li"),l=document.createElement("li"),c=document.createElement("li");r.classList.add("fa","fa-clone","w3-large","ctrlOptClone"),l.classList.add("fa","fa-trash-o","w3-large","ctrlOptDelete");var d=document.createElement("i"),u=document.createElement("i");return d.classList.add("fa","fa-angle-right","w3-small","ctrlOptRight"),u.classList.add("fa","fa-angle-left","w3-small","ctrlOptLeft"),c.classList.add("ctrlOptMoves"),c.appendChild(d),c.appendChild(document.createElement("br")),c.appendChild(u),d.addEventListener("click",function(){var t=settings.sections.indexOf(e);if(!(t>=settings.sections.length-1)){var n=settings.sections[t];settings.sections[t]=settings.sections[t+1],settings.sections[t+1]=n,p(),a.children[t+1].click()}}),u.addEventListener("click",function(){var t=settings.sections.indexOf(e);if(!(t<=0)){var n=settings.sections[t];settings.sections[t]=settings.sections[t-1],settings.sections[t-1]=n,p(),a.children[t-1].click()}}),r.addEventListener("click",function(){var t=new Section(e);settings.sections.push(t),w(settings.sections.length-1)}),l.addEventListener("click",function(){var t=settings.sections.indexOf(e);settings.sections.splice(t,1),b(t)}),o.appendChild(c),o.appendChild(r),o.appendChild(l),s.addEventListener("change",function(){e[t]=this.value,a.children[settings.sections.indexOf(e)].title=e[t]}),i.appendChild(s),i.appendChild(o),i},v=function(){function e(e){for(var a in e){var n=null;n=e[a]instanceof EnumerationValue?f(e,a,e[a].ownerEnum):"name"===a?g(e,a):m(e,a),n&&t.push(n)}}var t=null;return function(a){return t=[],e(a),e(a.target),t}}(),y=function(){if(this!==n&&!this.classList.contains("activated")){for(var e=-1,t=0;t<settings.sections.length;t++)a.children[t]!==this?a.children[t].classList.contains("activated")&&a.children[t].classList.remove("activated"):e=t;for(this.classList.add("activated");0!==i.children.length;)i.removeChild(i.children[0]);for(var t=0;t<h[e].length;t++)i.appendChild(h[e][t]);activeSection=settings.sections[e]}},w=function(e){var t=document.createElement("li");t.innerHTML=e.toString(),t.title=settings.sections[e].name,t.classList.add("sectionTab"),t.addEventListener("click",y),a.insertBefore(t,n),h[e]=v(settings.sections[e])},b=function(e){var t=a.children[e];t&&(t.removeEventListener("click",y),a.removeChild(t),p())},S=function(){for(;0!==e.children.length;)e.removeChild(e.children[0]);for(var a in settings){var n=m(settings,a);n&&e.appendChild(n)}for(;0!==t.children.length;)t.removeChild(t.children[0]);for(var a in settings.advanced){var n=m(settings.advanced,a);n&&t.appendChild(n)}},E=function(){for(;0!==s.children.length;)s.removeChild(s.children[0]);for(var e in settingsPresets){var t=document.createElement("li");t.innerHTML=e.toString(),t.addEventListener("click",function(){var t=e;return function(){loadPreset(t),p()}}()),s.appendChild(t)}};return function(h){0!==h&&(h||(h=refreshables.SETTINGS_BIT|refreshables.TABS_BIT|refreshables.PRESETLIST_BIT),e||(e=document.getElementById("globalSettings")),t||(t=document.getElementById("advancedSettings")),a||(a=document.getElementById("settingsSectionTabs")),n||(n=document.getElementById("addTab")),i||(i=document.getElementById("sectionSettings")),s||(s=document.getElementById("settingsPresetsList")),o||(o=document.getElementById("presetNameInput")),r||(r=document.getElementById("settingsPresetsOptOpen")),l||(l=document.getElementById("settingsPresetsOptSave")),c||(c=document.getElementById("downloader")),d||(d=document.getElementById("fileChooser")),0!==(h&refreshables.SETTINGS_BIT)&&S(),0!==(h&refreshables.TABS_BIT)&&p(),0!==(h&refreshables.PRESETLIST_BIT)&&E(),u||(n.addEventListener("click",function(){var e=new Section;settings.sections.push(e),w(settings.sections.length-1)}),d.addEventListener("change",function(e){for(var t=0;t<e.target.files.length-1;t++)loadFilePreset(e.target.files[t]);loadFilePreset(e.target.files[e.target.files.length-1],!0)}),r.addEventListener("click",function(){d.accept=".urm",d.click()}),l.addEventListener("click",function(){var e=o.value?o.value:"untitled";c.href="data:text/plain;base64,"+btoa(JSON.stringify(settings)),c.download=e+".urm",c.click();for(var t=0;void 0!==settingsPresets[e];)e=(o.value?o.value:"untitled")+" ("+t+")",t++;settingsPresets[e]=new Settings(settings),S(),p(),E()}),a.children.length>1&&y.call(a.children[0]),u=!0))}}();window.addEventListener("load",function(){function e(e){if(e.type.match("image.*")&&activeSection&&activeSection.type===sectionType.IMAGE){var t=new FileReader;t.addEventListener("load",function(e){activeSection.target.imageURL=e.target.result,refreshControls(refreshables.TABS_BIT)}),t.readAsDataURL(e)}}function t(e,t){B.src=t,document.title="Urmusic - "+e,B.play(),A.classList.contains("masked")||A.classList.add("masked")}function a(e){if(e.type.match("audio.*")){var a=new FileReader;a.addEventListener("load",function(a){t(e.name.substr(0,e.name.lastIndexOf(".")),a.target.result)}),a.readAsDataURL(e)}}function n(t){for(var n,i,s=0;s<t.length;s++)t[s].type.match("image.*")?n=t[s]:t[s].type.match("audio.*")?i=t[s]:t[s].name.endsWith(".urm")&&loadFilePreset(t[s],s===t.length-1);n&&e(n),i&&a(i)}function i(e,t,a){return e+a*(t-e)}function s(e,t,a){return t<0||t>=e.length?a:e[t]}function o(e,t,a,n){if(a){var o=Math.floor(t+.5);return l(i(s(e,o-1,n),s(e,o,n),.5),s(e,o,n),i(s(e,o,n),s(e,o+1,n),.5),t-o+.5)}var r=Math.floor(t),c=Math.ceil(t),d=s(e,r,n),u=s(e,c,n);return i(d,u,t-r)}function r(e,t){var a=t.minDecibels.value;return Math.max(o(E,i(t.freqStart.value,t.freqEnd.value,e)*E.length,t.quadratic,a)-a,0)/(t.maxDecibels.value-a)}function l(e,t,a,n){var i=(1-n)*(1-n)*e+2*(1-n)*n*t+n*n*a;return i}function c(){if(S.smoothingTimeConstant=settings.smoothingTimeConstant.value,T.smoothingTimeConstant=settings.advanced.lowpassSmooth,O.smoothingTimeConstant=settings.advanced.highpassSmooth,!E&&(E=new Float32Array(S.frequencyBinCount),B.paused))for(var e=0;e<E.length;e++)E[e]=Number.MIN_SAFE_INTEGER;if(!L&&(L=new Float32Array(S.frequencyBinCount),B.paused))for(var e=0;e<L.length;e++)L[e]=0;if(settings.advanced.enableLowpass&&!P&&(P=new Float32Array(T.frequencyBinCount),B.paused))for(var e=0;e<P.length;e++)P[e]=Number.MIN_SAFE_INTEGER;if(settings.advanced.enableHighpass&&!I&&(I=new Float32Array(O.frequencyBinCount),B.paused))for(var e=0;e<I.length;e++)I[e]=Number.MIN_SAFE_INTEGER;B.paused||(S.getFloatFrequencyData(E),S.getFloatTimeDomainData(L),settings.advanced.enableLowpass&&T.getFloatFrequencyData(P),settings.advanced.enableHighpass&&O.getFloatFrequencyData(I)),M.width==M.clientWidth&&M.height==M.clientHeight||(M.width=M.clientWidth,M.height=M.clientHeight),frameProps.minval=Math.min.apply(Math,E),frameProps.maxval=Math.max.apply(Math,E),frameProps.time=B.currentTime,frameProps.duration=B.duration,frameProps.imgw=0,frameProps.imgh=0,frameProps.imgr=0,settings.advanced.enableLowpass&&(frameProps.maxlowval=Math.max.apply(Math,P),frameProps.minlowval=Math.min.apply(Math,P)),settings.advanced.enableHighpass&&(frameProps.maxhighval=Math.max.apply(Math,I),frameProps.minhighval=Math.min.apply(Math,I)),H(),x(c)}function d(e,t,a){var n=i(t.startX,t.endX,a),s=t.yPos;if(t.polar>0){var o=Math.cos((.5*n+.5)*Math.PI*2),r=Math.sin((.5*n+.5)*Math.PI*2),l=o*s,c=r*s;n=i(n*e,l*e,t.polar),s=i(s*e,c*e,t.polar)}else n*=e,s*=e;return{x:n,y:s}}function u(e,t,a){var n=i(t.startX,t.endX,a),s=t.yPos;if(t.polar>0){var o=Math.cos((.5*n+.5)*Math.PI*2),r=Math.sin((.5*n+.5)*Math.PI*2),l=o*s,c=r*s;n=i(n*e,l*e,t.polar),s=i(s*e,c*e,t.polar)}else n*=e,s*=e;return{x:n,y:s}}function h(e,t,a){var n=Math.pow(r(a,t),t.exponent.value)*t.height.value,s=i(t.startX.value,t.endX.value,a),o=t.yPos.value,l=o+t.minHeight.value+n,c=s,d=t.polar.value;if(d>0){var u=Math.cos((.5*s+.5)*Math.PI*2),h=Math.sin((.5*s+.5)*Math.PI*2),p=u*o,m=h*o,f=u*l,g=h*l;s=i(s*e,p*e,d),o=i(o*e,m*e,d),c=i(c*e,f*e,d),l=i(l*e,g*e,d)}else s*=e,o*=e,c*=e,l*=e;return{x:s,y:o,ex:c,ey:l}}function p(e,t,a){var n=o(L,a*L.length,t.quadratic,0),s=Math.abs(Math.pow(n,t.exponent.value));n=(n>=0?s:-s)*t.height.value;var r=i(t.startX.value,t.endX.value,a),l=t.yPos.value,c=l+n,d=r,u=t.polar.value;if(u>0){var h=Math.cos((.5*r+.5)*Math.PI*2),p=Math.sin((.5*r+.5)*Math.PI*2),m=h*l,f=p*l,g=h*c,v=p*c;r=i(r*e,m*e,u),l=i(l*e,f*e,u),d=i(d*e,g*e,u),c=i(c*e,v*e,u)}else r*=e,l*=e,d*=e,c*=e;return{x:r,y:l,ex:d,ey:c}}function m(){navigator.userAgent.indexOf("Firefox/")===-1&&(D.style.marginRight="0px")}function f(){SC.initialize({client_id:q});var e=document.getElementById("soundcloudApp").parentNode.getElementsByClassName("appLinkInput")[0],a=e.parentNode.parentNode;e.addEventListener("change",function(){a.classList.add("loading"),SC.resolve(this.value).then(function(e){var n=new XMLHttpRequest;n.onload=function(n){t(e.title+" (SoundCloud)",n.target.responseURL),a.classList.remove("loading")},n.open("GET",e.stream_url+"?client_id="+q),n.send()},function(){a.classList.remove("loading")})})}function g(e){var t=document.createElement("div"),a=document.createElement("div"),n=document.createElement("input"),i=document.createElement("i");return t.classList.add("musicAppIconContainer"),t.appendChild(e),n.placeholder="Paste a link...",a.appendChild(n),a.appendChild(i),a.classList.add("appLinkForm"),n.classList.add("appLinkInput"),i.classList.add("loadIcon"),new Spinner(R).spin(i),t.appendChild(a),e.addEventListener("click",function(){t.classList.contains("activated")?t.classList.remove("activated"):t.classList.add("activated")}),t}function v(){for(var e=[];0!==Y.children.length;)e.push(g(Y.removeChild(Y.children[0])));for(var t=0,a=e.length;t<a;t++)Y.appendChild(e[t]);f()}function y(){if(!M||!F||!U)throw alert("Your browser isn't compatible"),new Error("Couldn't initialize");w=U.createMediaElementSource(B),b=U.createGain(),b.gain.value=.8,S=U.createAnalyser(),S.fftSize=2048,N=U.createBiquadFilter(),N.type="lowpass",T=U.createAnalyser(),T.fftSize=2048,C=U.createBiquadFilter(),C.type="highpass",O=U.createAnalyser(),O.fftSize=2048,M.width=document.body.clientWidth,M.height=document.body.clientHeight,M.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},!1),M.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),n(e.dataTransfer.files)},!1),localStorage.urmusic_volume?b.gain.value=localStorage.urmusic_volume:localStorage.urmusic_volume=b.gain.value,THEPLAYER.setupPlayer(document.getElementById("itsThePlayer"),{target:B,volume:b.gain.value,onvolumechange:function(e){b.gain.value=e,localStorage.urmusic_volume=e}}),B.crossOrigin="anonymous";var e=document.getElementById("settingsNav"),t=document.getElementById("presetMenuOpenCloseBtn"),a=document.getElementById("settingsPresetsMenu");document.getElementById("hambParent").addEventListener("click",function(n){e.classList.contains("activated")?e.classList.remove("activated"):e.classList.add("activated"),e.classList.contains("activated")||(a.classList.remove("opened"),t.classList.remove("opened"))}),t.addEventListener("click",function(){this.classList.contains("opened")?(this.classList.remove("opened"),a.classList.remove("opened")):(this.classList.add("opened"),a.classList.add("opened"))}),k.addEventListener("click",function(){D.style.marginRight=""}),N.connect(T),C.connect(O),w.connect(b),w.connect(S),w.connect(N),w.connect(C),b.connect(U.destination),_.addEventListener("load",function(){X=!0}),settings.watch("imageURL",function(e,t,a){return X=!1,_.src=a,a}),settings.advanced.watch("lowpassFreq",function(e,t,a){return N.frequency.value=a,a}),settings.advanced.watch("highpassFreq",function(e,t,a){return C.frequency.value=a,a}),settings.advanced.lowpassFreq=settings.advanced.lowpassFreq,settings.advanced.highpassFreq=settings.advanced.highpassFreq,v(),console.log(" _    _ ________     __  _ \n| |  | |  ____\\ \\   / / | |\tHey you! This app is highly customizable through the JavaScript\n| |__| | |__   \\ \\_/ /  | |\tconsole too! Have fun, and try not to broke everything :p!\n|  __  |  __|   \\   /   | |\t\n| |  | | |____   | |    |_|\tUrmusic V1.3.2\n|_|  |_|______|  |_|    (_)\tBy Nasso (https://nasso.github.io/)\n\n"),loadPreset(),c(),m()}var w,b,S,E,L,N,T,P,C,O,I,x=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},M=document.getElementById("cvs"),F=M.getContext("2d"),U=new AudioContext,q="09bfcfe5b0303000a41b9e9675c0cb47",R={lines:8,length:0,width:14,radius:19,scale:.3,corners:1,color:"#fff",opacity:0,rotate:90,direction:1,speed:1.5,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!0,position:"absolute"},X=!1,_=new Image,B=document.getElementById("audioElement"),A=document.getElementById("helpNav"),D=document.getElementById("firefoxIsBetter"),k=D.getElementsByClassName("close")[0],Y=document.getElementById("musicApps"),H=function(){function e(){r=o.dataCount.value;var e=o.mode;F.strokeStyle=s.color,F.fillStyle=s.color,F.lineWidth=o.lineWidth.value/100*Math.min(M.width,M.height),F.shadowColor=s.color,F.shadowBlur=l*i,F.lineCap=o.lineCap.name.toLowerCase(),F.beginPath();for(var t=0;t<r&&(o.drawLast||t!==r-1);t++){var a=t/(r-1),c=h(n,o,a);(e==drawMode.LINES||0==t&&o.clampShapeToZero)&&F.moveTo(c.x,c.y),
F.lineTo(c.ex,c.ey),t==r-1&&o.clampShapeToZero&&F.lineTo(c.x,c.y)}if(o.closeShape&&e!==drawMode.FILL&&F.closePath(),e===drawMode.FILL){if(o.smartFill)for(var t=r-1;t>=0;t--)if(o.drawLast||t!==r-1){var a=t/(r-1),u=d(n,o,a);F.lineTo(u.x,u.y)}F.fill()}else F.moveTo(0,0),F.stroke()}function t(){r=o.dataCount.value;var e=o.mode;F.strokeStyle=s.color,F.fillStyle=s.color,F.lineWidth=o.lineWidth.value/100*Math.min(M.width,M.height),F.shadowColor=s.color,F.shadowBlur=l*i,F.lineCap=o.lineCap.name.toLowerCase(),F.lineJoin=o.lineJoin.name.toLowerCase(),F.beginPath();for(var t=0;t<r&&(o.drawLast||t!==r-1);t++){var a=t/(r-1),c=p(n,o,a);(e==drawMode.LINES||0==t&&o.clampShapeToZero)&&F.moveTo(c.x,c.y),F.lineTo(c.ex,c.ey),t==r-1&&o.clampShapeToZero&&F.lineTo(c.x,c.y)}if(o.closeShape&&e!==drawMode.FILL&&F.closePath(),e===drawMode.FILL){if(o.smartFill)for(var t=r-1;t>=0;t--)if(o.drawLast||t!==r-1){var a=t/(r-1),d=u(n,o,a);F.lineTo(d.x,d.y)}F.fill()}else F.moveTo(0,0),F.stroke()}function a(){if(o.imageReady){F.shadowColor=s.color,F.shadowBlur=l*i,F.scale(1,-1);var e=o.image,t=o.imageBorderRadius.value*n;0!==t?(F.roundRect(-n/2,-n/2,n,n,t),F.clip(),F.drawImage(e,-n/2,-n/2,n,n)):F.drawImage(e,-n/2,-n/2,n,n)}}var n=0,i=0,s=null,o=null,r=32,l=0;return function(){aspect=M.width/M.height,n=Math.min(M.width,M.height),F.clearRect(0,0,M.width,M.height),F.fillStyle=settings.backgroundColor,F.fillRect(0,0,M.width,M.height),F.save(),F.translate(M.width/2,M.height/2),F.scale(.5,-.5),i=settings.globalScale.value,F.scale(i,i),F.translate(settings.globalOffsetX.value*n,settings.globalOffsetY.value*n),F.rotate(settings.globalRotation.value*Math.PI/180);for(var r=0;r<settings.sections.length;r++)s=settings.sections[r],o=s.target,s.visible&&(s.type===sectionType.IMAGE&&o.imageReady?(frameProps.imgw=o.image.width,frameProps.imgh=o.image.height,frameProps.imgr=frameProps.imgw/frameProps.imgh):frameProps.imgw=frameProps.imgh=frameProps.imgr=0,l=s.glowness.value,F.save(),F.translate(s.posX.value*n,s.posY.value*n),F.rotate(s.rotation.value*Math.PI/180),F.scale(s.scaleX.value,s.scaleY.value),F.globalAlpha=s.opacity.value,s.type===sectionType.FREQ?e():s.type===sectionType.TIME_DOM?t():s.type===sectionType.IMAGE&&a(),F.restore());F.restore()}}();y()});