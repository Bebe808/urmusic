function isNullOrUndef(e){return null===e||void 0===e}function EnumerationValue(e,t){this.name=t,this.ownerEnum=e}function Enumeration(e){if(!Array.isArray(e))throw new Error("No values specified for the Enumeration");for(var t=0;t<e.length;t++)this[e[t]]=new EnumerationValue(this,e[t])}function numberProperty(e){e||(e=0),"object"==typeof e&&e.hasOwnProperty("expr")&&(e=e.expr);var t=e.toString(),a=new Function(exprArgs.join(","),"return ("+t+")"),n={};return n.toJSON=function(){return t},Object.defineProperty(n,"value",{get:function(){try{return a(Math.random,Math.max,Math.min,Math.cos,Math.sin,Math.tan,Math.acos,Math.asin,Math.atan,Math.pow,Math.PI,frameProps.maxval,frameProps.minval,frameProps.time,frameProps.duration,frameProps.maxlowval,frameProps.minlowval,frameProps.maxhighval,frameProps.minhighval)}catch(e){return 0}}}),Object.defineProperty(n,"expr",{get:function(){return t},set:function(e){""===e&&(e="0"),t=e,a=new Function(exprArgs.join(","),"return ("+t.toLowerCase()+")")}}),n}function AdvancedSettings(e){this.set(e)}function Section(e){e=e||{},this.name=isNullOrUndef(e.name)?"A section":e.name,this.visible=!!isNullOrUndef(e.visible)||e.visible,this.minDecibels=numberProperty(isNullOrUndef(e.minDecibels)?-100:e.minDecibels),this.maxDecibels=numberProperty(isNullOrUndef(e.maxDecibels)?-20:e.maxDecibels),this.barCount=numberProperty(isNullOrUndef(e.barCount)?32:e.barCount),this.freqStart=numberProperty(isNullOrUndef(e.freqStart)?0:e.freqStart),this.freqEnd=numberProperty(isNullOrUndef(e.freqEnd)?.03:e.freqEnd),this.barsWidth=numberProperty(isNullOrUndef(e.barsWidth)?6:e.barsWidth),this.barsStartX=numberProperty(isNullOrUndef(e.barsStartX)?-1:e.barsStartX),this.barsEndX=numberProperty(isNullOrUndef(e.barsEndX)?1:e.barsEndX),this.barsY=numberProperty(isNullOrUndef(e.barsY)?-.5:e.barsY),this.color=isNullOrUndef(e.color)?"#ffffff":e.color,this.barsPow=numberProperty(isNullOrUndef(e.barsPow)?2:e.barsPow),this.barsHeight=numberProperty(isNullOrUndef(e.barsHeight)?.7:e.barsHeight),this.barsMinHeight=numberProperty(isNullOrUndef(e.barsMinHeight)?.01:e.barsMinHeight),this.glowness=numberProperty(isNullOrUndef(e.glowness)?0:e.glowness),this.polar=numberProperty(isNullOrUndef(e.polar)?0:e.polar),this.mode=isNullOrUndef(e.mode)?drawMode.LINES:drawMode[e.mode],this.clampShapeToZero=!!isNullOrUndef(e.clampShapeToZero)||e.clampShapeToZero,this.closeShape=!!isNullOrUndef(e.closeShape)||e.closeShape,this.smartFill=!isNullOrUndef(e.smartFill)&&e.smartFill,this.drawLast=!!isNullOrUndef(e.drawLast)||e.drawLast,this.quadratic=!!isNullOrUndef(e.quadratic)||e.quadratic}function Settings(e){this.set(e)}function loadFilePreset(e,t){if(e){var a=e.name.substr(0,e.name.lastIndexOf(".")),n=new FileReader;n.onload=function(e){for(var n=new Settings(JSON.parse(e.target.result)),r=a,s=0;void 0!==settingsPresets[r];)r=a+" ("+s+")",s++;settingsPresets[r]=n,t&&loadPreset(r)},n.readAsText(e)}}function loadPreset(e){if(isNullOrUndef(e)){var t=[];for(var a in settingsPresets)t.push(a);e=t[Math.floor(Math.random()*t.length)]}settings.set(settingsPresets[e]),refreshControls()}Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(e,t){var a=this[e],n=a,r=function(){return n},s=function(r){return a=n,n=t.call(this,e,a,r)};delete this[e]&&Object.defineProperty(this,e,{get:r,set:s,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(e){var t=this[e];delete this[e],this[e]=t}}),CanvasRenderingContext2D.prototype.roundRect=function(e,t,a,n,r){a<2*r&&(r=a/2),n<2*r&&(r=n/2),this.beginPath(),this.moveTo(e+r,t),this.arcTo(e+a,t,e+a,t+n,r),this.arcTo(e+a,t+n,e,t+n,r),this.arcTo(e,t+n,e,t,r),this.arcTo(e,t,e+a,t,r),this.closePath()},EnumerationValue.prototype.toJSON=function(){return this.name},EnumerationValue.prototype.toString=EnumerationValue.prototype.toJSON;var AudioContext=window.AudioContext||window.webkitAudioContext,drawMode=new Enumeration(["LINES","FILL","OUTLINE"]),refreshables={SETTINGS_BIT:1,TABS_BIT:2,PRESETLIST_BIT:4},exprArgs=["rand","max","min","cos","sin","tan","acos","asin","atan","pow","pi","maxval","minval","time","duration","maxlowval","minlowval","maxhighval","minhighval"];AdvancedSettings.prototype.set=function(e){e=e||{},this.enableLowpass=!isNullOrUndef(e.enableLowpass)&&e.enableLowpass,this.enableHighpass=!isNullOrUndef(e.enableHighpass)&&e.enableHighpass,this.lowpassFreq=isNullOrUndef(e.lowpassFreq)?120:e.lowpassFreq,this.highpassFreq=isNullOrUndef(e.highpassFreq)?480:e.highpassFreq},Settings.prototype.addSection=function(e){return this.sections.push(new Section(e)),this},Settings.prototype.set=function(e){if(e=e||{},this.smoothingTimeConstant=numberProperty(isNullOrUndef(e.smoothingTimeConstant)?.65:e.smoothingTimeConstant),this.sections=[],Array.isArray(e.sections))for(var t=0;t<e.sections.length;t++)this.addSection(e.sections[t]);this.globalScale=numberProperty(isNullOrUndef(e.globalScale)?1:e.globalScale),this.globalOffsetX=numberProperty(isNullOrUndef(e.globalOffsetX)?0:e.globalOffsetX),this.globalOffsetY=numberProperty(isNullOrUndef(e.globalOffsetY)?0:e.globalOffsetY),this.globalRotation=numberProperty(isNullOrUndef(e.globalRotation)?0:e.globalRotation),this.imageURL=isNullOrUndef(e.imageURL)?"":e.imageURL,this.imageX=numberProperty(isNullOrUndef(e.imageX)?0:e.imageX),this.imageY=numberProperty(isNullOrUndef(e.imageY)?0:e.imageY),this.imageWidth=numberProperty(isNullOrUndef(e.imageWidth)?.4:e.imageWidth),this.imageHeight=numberProperty(isNullOrUndef(e.imageHeight)?.4:e.imageHeight),this.imageBorderRadius=numberProperty(isNullOrUndef(e.imageBorderRadius)?0:e.imageBorderRadius),this.imageRot=numberProperty(isNullOrUndef(e.imageRot)?0:e.imageRot),this.backgroundColor=isNullOrUndef(e.backgroundColor)?"#3b3b3b":e.backgroundColor,this.advanced?this.advanced.set(e.advanced):this.advanced=new AdvancedSettings(e.advanced)};var settingsPresets={Default:(new Settings).addSection(),DubstepGutter:new Settings(JSON.parse('{"smoothingTimeConstant":"0.5","sections":[{"name":"Bass top","visible":true,"minDecibels":"-70","maxDecibels":"-30","barCount":"128","freqStart":"-0.002","freqEnd":"0.02","barsWidth":"1","barsStartX":"-0.55","barsEndX":"0.1","barsY":"0.2","color":"#ffffff","barsPow":"5","barsHeight":"0.05","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"LINES","clampShapeToZero":true,"closeShape":true,"smartFill":false,"drawLast":true,"quadratic":true},{"name":"Bass bottom","visible":true,"minDecibels":"-70","maxDecibels":"-30","barCount":"128","freqStart":"-0.002","freqEnd":"0.02","barsWidth":"1","barsStartX":"0.65","barsEndX":"0.1","barsY":"0.2","color":"#ffffff","barsPow":"5","barsHeight":"0.05","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"LINES","clampShapeToZero":true,"closeShape":true,"smartFill":false,"drawLast":false,"quadratic":true},{"name":"High top","visible":true,"minDecibels":"-70","maxDecibels":"-30","barCount":"128","freqStart":"0.02","freqEnd":"0.035","barsWidth":"1","barsStartX":"1.45","barsEndX":"1.05","barsY":"0.2","color":"#ffffff","barsPow":"3","barsHeight":"0.03","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"LINES","clampShapeToZero":true,"closeShape":true,"smartFill":false,"drawLast":true,"quadratic":true},{"name":"High bottom","visible":true,"minDecibels":"-70","maxDecibels":"-30","barCount":"128","freqStart":"0.02","freqEnd":"0.035","barsWidth":"1","barsStartX":"0.65","barsEndX":"1.05","barsY":"0.2","color":"#ffffff","barsPow":"3","barsHeight":"0.03","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"LINES","clampShapeToZero":true,"closeShape":true,"smartFill":false,"drawLast":true,"quadratic":true}],"globalScale":"max(max((maxlowval + 70) / 50, 0) * 3.8, 1.5)","globalOffsetX":"rand() * max((maxlowval + 70) / 50, 0) * 0.01 - 0.005","globalOffsetY":"rand() * max((maxlowval + 70) / 50, 0) * 0.01 - 0.005","globalRotation":"0","imageURL":"dsg.png","imageX":"0","imageY":"0","imageWidth":"0.405","imageHeight":"0.405","imageBorderRadius":"0.405","imageRot":"0","backgroundColor":"#3b3b3b","advanced":{"enableLowpass":true,"enableHighpass":false,"lowpassFreq":20,"highpassFreq":480}}')),"Drop the Bassline":new Settings(JSON.parse('{"smoothingTimeConstant":"0.5","sections":[{"name":"A section","visible":true,"minDecibels":"-48","maxDecibels":"-20","barCount":"128","freqStart":"0","freqEnd":"0.015","barsWidth":"0.8","barsStartX":"-0.5","barsEndX":"0.5","barsY":"0.4","color":"#ffffff","barsPow":"3","barsHeight":"0.23","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"FILL","clampShapeToZero":false,"closeShape":false,"smartFill":true,"drawLast":true,"quadratic":true},{"name":"A section","visible":true,"minDecibels":"-48","maxDecibels":"-20","barCount":"128","freqStart":"0","freqEnd":"0.015","barsWidth":"0.8","barsStartX":"1.5","barsEndX":"0.5","barsY":"0.4","color":"#ffffff","barsPow":"3","barsHeight":"0.23","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"FILL","clampShapeToZero":false,"closeShape":false,"smartFill":true,"drawLast":true,"quadratic":true},{"name":"A section","visible":true,"minDecibels":"-48","maxDecibels":"-20","barCount":"128","freqStart":"0","freqEnd":"0.015","barsWidth":"0.8","barsStartX":"-0.5","barsEndX":"0.5","barsY":"0.4","color":"#ff0000","barsPow":"3","barsHeight":"0.19","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"FILL","clampShapeToZero":false,"closeShape":false,"smartFill":true,"drawLast":true,"quadratic":true},{"name":"A section","visible":true,"minDecibels":"-48","maxDecibels":"-20","barCount":"128","freqStart":"0","freqEnd":"0.015","barsWidth":"0.8","barsStartX":"1.5","barsEndX":"0.5","barsY":"0.4","color":"#ff0000","barsPow":"3","barsHeight":"0.19","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"FILL","clampShapeToZero":false,"closeShape":false,"smartFill":true,"drawLast":true,"quadratic":true},{"name":"A section","visible":true,"minDecibels":"-48","maxDecibels":"-20","barCount":"128","freqStart":"0","freqEnd":"0.015","barsWidth":"0.8","barsStartX":"-0.5","barsEndX":"0.5","barsY":"0.4","color":"#ffffff","barsPow":"3","barsHeight":"0.15","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"FILL","clampShapeToZero":false,"closeShape":false,"smartFill":true,"drawLast":true,"quadratic":true},{"name":"A section","visible":true,"minDecibels":"-48","maxDecibels":"-20","barCount":"128","freqStart":"0","freqEnd":"0.015","barsWidth":"0.8","barsStartX":"1.5","barsEndX":"0.5","barsY":"0.4","color":"#ffffff","barsPow":"3","barsHeight":"0.15","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"FILL","clampShapeToZero":false,"closeShape":false,"smartFill":true,"drawLast":true,"quadratic":true}],"globalScale":"max(max((maxlowval + 70) / 50, 0) * 1.2, 0.8)","globalOffsetX":"rand() * max((maxlowval + 70) / 50, 0) * 0.01 - 0.005","globalOffsetY":"rand() * max((maxlowval + 70) / 50, 0) * 0.01 - 0.005","globalRotation":"0","imageURL":"dtb.png","imageX":"0","imageY":"0","imageWidth":"0.8","imageHeight":"0.8","imageBorderRadius":"0.8","imageRot":"0","backgroundColor":"#3b3b3b","advanced":{"enableLowpass":true,"enableHighpass":false,"lowpassFreq":"100","highpassFreq":480}}')),BOD:new Settings(JSON.parse('{"smoothingTimeConstant":"0.65","sections":[{"name":"A section","visible":true,"minDecibels":"-65","maxDecibels":"-10","barCount":"256","freqStart":"0","freqEnd":"0.1","barsWidth":"0.5","barsStartX":"-1","barsEndX":"1","barsY":"0.2","color":"#ff0000","barsPow":"3","barsHeight":"-1","barsMinHeight":"-0.002","glowness":"64","polar":"0","mode":"LINES","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true}],"globalScale":"1","globalOffsetX":"0","globalOffsetY":"0","globalRotation":"0","imageURL":"","imageX":"0","imageY":"0","imageWidth":"0.4","imageHeight":"0.4","imageRot":"0","backgroundColor":"#000000"}'))},settings=new Settings,frameProps={maxval:0,minval:Number.MIN_SAFE_INTEGER,maxlowval:0,minlowval:Number.MIN_SAFE_INTEGER,maxhighval:0,minhighval:Number.MIN_SAFE_INTEGER},refreshControls=function(){var e=null,t=null,a=null,n=null,r=null,s=null,i=null,o=null,l=null,d=null,c=null,u=!1,h=[],m=function(){for(var e=-1,t=0;t<a.children.length;t++)a.children[t].classList.contains("activated")&&(e=t);for(;0!==r.children.length;)r.removeChild(r.children[0]);for(;0!==a.children.length&&a.children[0]!==n;)a.removeChild(a.children[0]);for(var t=0;t<settings.sections.length;t++)w(t);if(e!==-1){for(var t=0;t<h[e].length;t++)r.appendChild(h[e][t]);a.children[e].classList.add("activated")}},f=function(e,t){var a=e[t];if("object"==typeof a&&!a.hasOwnProperty("expr")||"function"==typeof a)return null;var n=document.createElement("li"),r=document.createElement("span"),s=document.createElement("input");if(n.classList.add("settingsCtrl"),r.classList.add("ctrlName"),s.classList.add("ctrlInput"),r.innerHTML=t,"boolean"==typeof a)s.type="checkbox",s.checked=a;else if(t.toLowerCase().endsWith("color"))s.type="color",s.value=a.toString();else{s.type="text",s.placeholder=a.hasOwnProperty("expr")?"expression":typeof a;var i=a.toString();a.hasOwnProperty("expr")?s.value=a.expr:i.startsWith("data:")?s.value="DataURL":s.value=a.toString()}if(s.addEventListener("change",function(){if("number"==typeof e[t]){if(""===this.value)return;e[t]=this.value}else"boolean"==typeof e[t]?e[t]=this.checked:e[t].hasOwnProperty("expr")?e[t].expr=this.value:e[t]=this.value}),n.appendChild(r),n.appendChild(s),"boolean"==typeof a){var o=document.createElement("span");o.classList.add("ctrlCheckbox","fa"),o.addEventListener("click",function(a){e[t]=s.checked=!s.checked}),n.appendChild(o)}return n},g=function(e,t,a){var n=(e[t],document.createElement("li")),r=document.createElement("span"),s=document.createElement("select");n.classList.add("settingsCtrl"),r.classList.add("ctrlName"),s.classList.add("ctrlInput"),r.innerHTML=t;for(var i in a){var o=document.createElement("option");o.value=i,o.innerHTML=i,s.appendChild(o),e[t]===a[i]&&(s.value=i)}return s.addEventListener("change",function(){var n=a[this.value];e[t]=n}),n.appendChild(r),n.appendChild(s),n},p=function(e,t){var n=e[t],r=document.createElement("li"),s=document.createElement("input"),i=document.createElement("ul");r.classList.add("settingsMajorCtrl"),s.classList.add("ctrlMajorInput"),i.classList.add("ctrlOptions"),s.type="text",s.placeholder=t,s.value=n.toString();var o=document.createElement("li"),l=document.createElement("li"),d=document.createElement("li");o.classList.add("fa","fa-clone","w3-large","ctrlOptClone"),l.classList.add("fa","fa-trash-o","w3-large","ctrlOptDelete");var c=document.createElement("i"),u=document.createElement("i");return c.classList.add("fa","fa-angle-right","w3-small","ctrlOptRight"),u.classList.add("fa","fa-angle-left","w3-small","ctrlOptLeft"),d.classList.add("ctrlOptMoves"),d.appendChild(c),d.appendChild(document.createElement("br")),d.appendChild(u),c.addEventListener("click",function(){var t=settings.sections.indexOf(e);if(!(t>=settings.sections.length-1)){var n=settings.sections[t];settings.sections[t]=settings.sections[t+1],settings.sections[t+1]=n,m(),a.children[t+1].click()}}),u.addEventListener("click",function(){var t=settings.sections.indexOf(e);if(!(t<=0)){var n=settings.sections[t];settings.sections[t]=settings.sections[t-1],settings.sections[t-1]=n,m(),a.children[t-1].click()}}),o.addEventListener("click",function(){var t=new Section(e);settings.sections.push(t),w(settings.sections.length-1)}),l.addEventListener("click",function(){var t=settings.sections.indexOf(e);settings.sections.splice(t,1),S(t)}),i.appendChild(d),i.appendChild(o),i.appendChild(l),s.addEventListener("change",function(){e[t]=this.value,a.children[settings.sections.indexOf(e)].title=e[t]}),r.appendChild(s),r.appendChild(i),r},b=function(e){var t=[];for(var a in e){var n=null;n=e[a]instanceof EnumerationValue?g(e,a,e[a].ownerEnum):"name"===a?p(e,a):f(e,a),n&&t.push(n)}return t},v=function(e){if(this!==n&&!this.classList.contains("activated")){for(var t=-1,s=0;s<settings.sections.length;s++)a.children[s]!==this?a.children[s].classList.contains("activated")&&a.children[s].classList.remove("activated"):t=s;for(this.classList.add("activated");0!==r.children.length;)r.removeChild(r.children[0]);for(var s=0;s<h[t].length;s++)r.appendChild(h[t][s])}},w=function(e){var t=document.createElement("li");t.innerHTML=e.toString(),t.title=settings.sections[e].name,t.classList.add("sectionTab"),t.addEventListener("click",v),a.insertBefore(t,n),h[e]=b(settings.sections[e])},S=function(e){var t=a.children[e];t&&(t.removeEventListener("click",v),a.removeChild(t),m())},E=function(){for(;0!==e.children.length;)e.removeChild(e.children[0]);for(var a in settings){var n=f(settings,a);n&&e.appendChild(n)}for(;0!==t.children.length;)t.removeChild(t.children[0]);for(var a in settings.advanced){var n=f(settings.advanced,a);n&&t.appendChild(n)}},y=function(){for(;0!==s.children.length;)s.removeChild(s.children[0]);for(var e in settingsPresets){var t=document.createElement("li");t.innerHTML=e.toString(),t.addEventListener("click",function(){var t=e;return function(){loadPreset(t),m()}}()),s.appendChild(t)}};return function(h){0!==h&&(h||(h=refreshables.SETTINGS_BIT|refreshables.TABS_BIT|refreshables.PRESETLIST_BIT),e||(e=document.getElementById("globalSettings")),t||(t=document.getElementById("advancedSettings")),a||(a=document.getElementById("settingsSectionTabs")),n||(n=document.getElementById("addTab")),r||(r=document.getElementById("sectionSettings")),s||(s=document.getElementById("settingsPresetsList")),i||(i=document.getElementById("presetNameInput")),o||(o=document.getElementById("settingsPresetsOptOpen")),l||(l=document.getElementById("settingsPresetsOptSave")),d||(d=document.getElementById("downloader")),c||(c=document.getElementById("fileChooser")),u||(n.addEventListener("click",function(e){var t=new Section;settings.sections.push(t),w(settings.sections.length-1)}),c.addEventListener("change",function(e){for(var t=0;t<e.target.files.length-1;t++)loadFilePreset(e.target.files[t]);loadFilePreset(e.target.files[e.target.files.length-1],!0)}),o.addEventListener("click",function(e){c.accept=".urm",c.click()}),l.addEventListener("click",function(e){var t=i.value?i.value:"untitled";d.href="data:text/plain;base64,"+btoa(JSON.stringify(settings)),d.download=t+".urm",d.click();for(var a=0;void 0!==settingsPresets[t];)t=(i.value?i.value:"untitled")+" ("+a+")",a++;settingsPresets[t]=new Settings(settings),E(),m(),y()}),u=!0),0!==(h&refreshables.SETTINGS_BIT)&&E(),0!==(h&refreshables.TABS_BIT)&&m(),0!==(h&refreshables.PRESETLIST_BIT)&&y(),a.children[0]&&v.call(a.children[0]))}}();window.onload=function(){function e(e){if(e.type.match("image.*")){var t=new FileReader;t.addEventListener("load",function(e){settings.imageURL=e.target.result,refreshControls(refreshables.SETTINGS_BIT)}),t.readAsDataURL(e)}}function t(e){if(e.type.match("audio.*")){var t=new FileReader,a=e.name.substr(0,e.name.lastIndexOf("."));document.title="Urmusic - "+a,t.addEventListener("load",function(e){M.src=e.target.result,M.play()}),t.readAsDataURL(e),q.classList.contains("masked")||q.classList.add("masked")}}function a(a){for(var n,r,s=0;s<a.length;s++)a[s].type.match("image.*")?n=a[s]:a[s].type.match("audio.*")?r=a[s]:a[s].name.endsWith(".urm")&&loadFilePreset(a[s],s===a.length-1);n&&e(n),r&&t(r)}function n(e,t,a){return e+a*(t-e)}function r(e,t,a){return t<0||t>=e.length?a:e[t]}function s(e,t,a,s){if(a){var i=Math.floor(t+.5);return l(n(r(e,i-1,s),r(e,i,s),.5),r(e,i,s),n(r(e,i,s),r(e,i+1,s),.5),t-i+.5)}var o=Math.floor(t),d=Math.ceil(t),c=r(e,o,s),u=r(e,d,s);return n(c,u,t-o)}function i(e){var t={};for(var a in e){var n=e[a];"object"==typeof n&&n.hasOwnProperty("expr")?t[a]=n.value:t[a]=n}return t}function o(e,t){return Math.max(s(v,n(t.freqStart,t.freqEnd,e)*v.length,t.quadratic,t.minDecibels)-t.minDecibels,0)/(t.maxDecibels-t.minDecibels)}function l(e,t,a,n){var r=(1-n)*(1-n)*e+2*(1-n)*n*t+n*n*a;return r}function d(){if(b.smoothingTimeConstant=settings.smoothingTimeConstant.value,S.smoothingTimeConstant=settings.smoothingTimeConstant.value,L.smoothingTimeConstant=settings.smoothingTimeConstant.value,!v&&(v=new Float32Array(b.frequencyBinCount),M.paused))for(var e=0;e<v.length;e++)v[e]=Number.MIN_SAFE_INTEGER;if(settings.advanced.enableLowpass&&!E&&(E=new Float32Array(S.frequencyBinCount),M.paused))for(var e=0;e<E.length;e++)E[e]=Number.MIN_SAFE_INTEGER;if(settings.advanced.enableHighpass&&!P&&(P=new Float32Array(L.frequencyBinCount),M.paused))for(var e=0;e<P.length;e++)P[e]=Number.MIN_SAFE_INTEGER;M.paused||(b.getFloatFrequencyData(v),settings.advanced.enableLowpass&&S.getFloatFrequencyData(E),settings.advanced.enableHighpass&&L.getFloatFrequencyData(P)),x.width==x.clientWidth&&x.height==x.clientHeight||(x.width=x.clientWidth,x.height=x.clientHeight),frameProps.minval=Math.min.apply(Math,v),frameProps.maxval=Math.max.apply(Math,v),frameProps.time=M.currentTime,frameProps.duration=M.duration,settings.advanced.enableLowpass&&(frameProps.maxlowval=Math.max.apply(Math,E),frameProps.minlowval=Math.min.apply(Math,E)),settings.advanced.enableHighpass&&(frameProps.maxhighval=Math.max.apply(Math,P),frameProps.minhighval=Math.min.apply(Math,P)),h(),O(d)}function c(e,t,a,r){var s=n(a.barsStartX,a.barsEndX,r),i=a.barsY;if(a.polar>0){var o=Math.cos((.5*s+.5)*Math.PI*2),l=Math.sin((.5*s+.5)*Math.PI*2),d=o*i,c=l*i;s=n(s*e,d*e,a.polar),i=n(i*t,c*t,a.polar)}else s*=e,i*=t;return{x:s,y:i}}function u(e,t,a,r){var s=Math.pow(o(r,a),a.barsPow)*a.barsHeight,i=n(a.barsStartX,a.barsEndX,r),l=a.barsY,d=l+a.barsMinHeight+s,c=i;if(a.polar>0){var u=Math.cos((.5*i+.5)*Math.PI*2),h=Math.sin((.5*i+.5)*Math.PI*2),m=u*l,f=h*l,g=u*d,p=h*d;i=n(i*e,m*e,a.polar),l=n(l*t,f*t,a.polar),c=n(c*e,g*e,a.polar),d=n(d*t,p*t,a.polar)}else i*=e,l*=t,c*=e,d*=t;return{x:i,y:l,ex:c,ey:d}}function h(){var e=x.width/x.height,t=x.width,a=x.height;t>a?t/=e:a*=e,N.clearRect(0,0,x.width,x.height),N.fillStyle=settings.backgroundColor,N.fillRect(0,0,x.width,x.height),N.save(),N.translate(x.width/2,x.height/2),N.scale(.5,-.5);var n=settings.globalScale.value;N.scale(n,n),N.translate(settings.globalOffsetX.value*t,settings.globalOffsetY.value*a),N.rotate(settings.globalRotation.value);for(var r=0;r<settings.sections.length;r++){var s=i(settings.sections[r]),o=s.mode,l=s.barCount;if(s.visible){N.strokeStyle=s.color,N.fillStyle=s.color,N.lineWidth=s.barsWidth/100*Math.min(x.width,x.height),N.shadowColor=s.color,N.shadowBlur=s.glowness*n,N.beginPath();for(var d=0;d<l&&(s.drawLast||d!==l-1);d++){var h=d/(l-1),m=u(t,a,s,h);(o==drawMode.LINES||0==d&&s.clampShapeToZero)&&N.moveTo(m.x,m.y),N.lineTo(m.ex,m.ey),d==l-1&&s.clampShapeToZero&&N.lineTo(m.x,m.y)}if(s.closeShape&&o===drawMode.OUTLINE&&N.closePath(),o===drawMode.FILL){if(s.smartFill)for(var d=l-1;d>=0;d--)if(s.drawLast||d!==l-1){var h=d/(l-1),f=c(t,a,s,h);N.lineTo(f.x,f.y)}N.fill()}else N.stroke()}}if(T){N.shadowColor="rgba(0, 0, 0, 0)",N.shadowBlur=0;var g=settings.imageWidth.value,p=settings.imageHeight.value;N.scale(1,-1),N.rotate(settings.imageRot.value);var b=settings.imageBorderRadius.value*t;0!==b?(N.save(),N.roundRect((settings.imageX.value-g/2)*t,(settings.imageY.value-p/2)*a,g*t,p*a,b),N.clip(),N.drawImage(I,(settings.imageX.value-g/2)*t,(settings.imageY.value-p/2)*a,g*t,p*a),N.restore()):N.drawImage(I,(settings.imageX.value-g/2)*t,(settings.imageY.value-p/2)*a,g*t,p*a)}N.restore()}function m(){navigator.userAgent.indexOf("Firefox/")===-1&&(F.style.marginRight="0px")}function f(){if(!x||!N||!C)throw alert("Your browser isn't compatible"),new Error("Couldn't initialize");g=C.createMediaElementSource(M),p=C.createGain(),b=C.createAnalyser(),b.fftSize=2048,w=C.createBiquadFilter(),w.type="lowpass",S=C.createAnalyser(),S.fftSize=2048,y=C.createBiquadFilter(),y.type="highpass",L=C.createAnalyser(),L.fftSize=2048,x.width=document.body.clientWidth,x.height=document.body.clientHeight,x.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},!1),x.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),a(e.dataTransfer.files)},!1),localStorage.urmusic_volume?M.volume=localStorage.urmusic_volume:localStorage.urmusic_volume=M.volume,M.addEventListener("volumechange",function(e){p.gain.value=0===M.volume?0:1/M.volume,localStorage.urmusic_volume=M.volume}),M.crossOrigin="anonymous";var e=document.getElementById("settingsNav"),t=document.getElementById("presetMenuOpenCloseBtn"),n=document.getElementById("settingsPresetsMenu");document.getElementById("hambParent").addEventListener("click",function(a){e.classList.contains("activated")?e.classList.remove("activated"):e.classList.add("activated"),e.classList.contains("activated")||(n.classList.remove("opened"),t.classList.remove("opened"))}),t.addEventListener("click",function(){this.classList.contains("opened")?(this.classList.remove("opened"),n.classList.remove("opened")):(this.classList.add("opened"),n.classList.add("opened"))}),_.addEventListener("click",function(){F.style.marginRight=""}),p.gain.value=0===M.volume?0:1/M.volume,w.connect(S),y.connect(L),g.connect(p),p.connect(b),p.connect(w),p.connect(y),g.connect(C.destination),I.addEventListener("load",function(){T=!0}),settings.watch("imageURL",function(e,t,a){return T=!1,I.src=a,a}),settings.advanced.watch("lowpassFreq",function(e,t,a){return w.frequency.value=a,a}),settings.advanced.watch("highpassFreq",function(e,t,a){return y.frequency.value=a,a}),settings.advanced.lowpassFreq=settings.advanced.lowpassFreq,settings.advanced.highpassFreq=settings.advanced.highpassFreq,console.log(" _    _ ________     __  _ \n| |  | |  ____\\ \\   / / | |\tHey you! This app is highly customizable through the JavaScript\n| |__| | |__   \\ \\_/ /  | |\tconsole too! Have fun, and try not to broke everything :p!\n|  __  |  __|   \\   /   | |\t\n| |  | | |____   | |    |_|\tUrmusic V1.0.1\n|_|  |_|______|  |_|    (_)\tBy Nasso (https://nasso.github.io/)\n\n"),loadPreset(),d(),m()}var g,p,b,v,w,S,E,y,L,P,O=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},x=document.getElementById("cvs"),N=x.getContext("2d"),C=new AudioContext,T=!1,I=new Image,M=document.getElementById("audioElement"),q=document.getElementById("helpNav"),F=document.getElementById("firefoxIsBetter"),_=F.getElementsByClassName("close")[0];f()};