function isNullOrUndef(e){return null===e||void 0===e}function EnumerationValue(e,t){this.name=t,this.ownerEnum=e}function Enumeration(e){if(!Array.isArray(e))throw new Error("No values specified for the Enumeration");for(var t=0;t<e.length;t++)this[e[t]]=new EnumerationValue(this,e[t])}function numberProperty(e){e||(e=0),"object"==typeof e&&e.hasOwnProperty("expr")&&(e=e.expr);var t=e.toString(),a=new Function(exprArgs.join(","),"return ("+t+")"),n={};return n.toJSON=function(){return t},Object.defineProperty(n,"value",{get:function(){try{return a(Math.random,Math.max,Math.min,Math.cos,Math.sin,Math.tan,Math.acos,Math.asin,Math.atan,Math.pow,Math.PI,frameProps.maxval,frameProps.minval,frameProps.time,frameProps.duration,frameProps.maxlowval,frameProps.minlowval,frameProps.maxhighval,frameProps.minhighval)}catch(e){return 0}}}),Object.defineProperty(n,"expr",{get:function(){return t},set:function(e){""===e&&(e="0"),t=e,a=new Function(exprArgs.join(","),"return ("+t.toLowerCase()+")")}}),n}function AdvancedSettings(e){this.set(e)}function Section(e){e=e||{},this.name=isNullOrUndef(e.name)?"A section":e.name,this.visible=!!isNullOrUndef(e.visible)||e.visible,this.minDecibels=numberProperty(isNullOrUndef(e.minDecibels)?-100:e.minDecibels),this.maxDecibels=numberProperty(isNullOrUndef(e.maxDecibels)?-20:e.maxDecibels),this.barCount=numberProperty(isNullOrUndef(e.barCount)?32:e.barCount),this.freqStart=numberProperty(isNullOrUndef(e.freqStart)?0:e.freqStart),this.freqEnd=numberProperty(isNullOrUndef(e.freqEnd)?.03:e.freqEnd),this.barsWidth=numberProperty(isNullOrUndef(e.barsWidth)?6:e.barsWidth),this.barsStartX=numberProperty(isNullOrUndef(e.barsStartX)?-1:e.barsStartX),this.barsEndX=numberProperty(isNullOrUndef(e.barsEndX)?1:e.barsEndX),this.barsY=numberProperty(isNullOrUndef(e.barsY)?-.5:e.barsY),this.color=isNullOrUndef(e.color)?"#ffffff":e.color,this.barsPow=numberProperty(isNullOrUndef(e.barsPow)?2:e.barsPow),this.barsHeight=numberProperty(isNullOrUndef(e.barsHeight)?.7:e.barsHeight),this.barsMinHeight=numberProperty(isNullOrUndef(e.barsMinHeight)?.01:e.barsMinHeight),this.glowness=numberProperty(isNullOrUndef(e.glowness)?0:e.glowness),this.polar=numberProperty(isNullOrUndef(e.polar)?0:e.polar),this.mode=isNullOrUndef(e.mode)?drawMode.LINES:drawMode[e.mode],this.clampShapeToZero=!!isNullOrUndef(e.clampShapeToZero)||e.clampShapeToZero,this.closeShape=!!isNullOrUndef(e.closeShape)||e.closeShape,this.smartFill=!isNullOrUndef(e.smartFill)&&e.smartFill,this.drawLast=!!isNullOrUndef(e.drawLast)||e.drawLast,this.quadratic=!!isNullOrUndef(e.quadratic)||e.quadratic}function Settings(e){this.set(e)}function loadFilePreset(e,t){if(e){var a=e.name.substr(0,e.name.lastIndexOf(".")),n=new FileReader;n.onload=function(e){for(var n=new Settings(JSON.parse(e.target.result)),s=a,r=0;void 0!==settingsPresets[s];)s=a+" ("+r+")",r++;settingsPresets[s]=n,t&&loadPreset(s)},n.readAsText(e)}}function loadPreset(e){if(isNullOrUndef(e)){var t=[];for(var a in settingsPresets)t.push(a);e=t[Math.floor(Math.random()*t.length)]}settings.set(settingsPresets[e]),refreshControls()}Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(e,t){var a=this[e],n=a,s=function(){return n},r=function(s){return a=n,n=t.call(this,e,a,s)};delete this[e]&&Object.defineProperty(this,e,{get:s,set:r,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(e){var t=this[e];delete this[e],this[e]=t}}),CanvasRenderingContext2D.prototype.roundRect=function(e,t,a,n,s){a<2*s&&(s=a/2),n<2*s&&(s=n/2),this.beginPath(),this.moveTo(e+s,t),this.arcTo(e+a,t,e+a,t+n,s),this.arcTo(e+a,t+n,e,t+n,s),this.arcTo(e,t+n,e,t,s),this.arcTo(e,t,e+a,t,s),this.closePath()},EnumerationValue.prototype.toJSON=function(){return this.name},EnumerationValue.prototype.toString=EnumerationValue.prototype.toJSON;var AudioContext=window.AudioContext||window.webkitAudioContext,drawMode=new Enumeration(["LINES","FILL","OUTLINE"]),refreshables={SETTINGS_BIT:1,TABS_BIT:2,PRESETLIST_BIT:4},exprArgs=["rand","max","min","cos","sin","tan","acos","asin","atan","pow","pi","maxval","minval","time","duration","maxlowval","minlowval","maxhighval","minhighval"];AdvancedSettings.prototype.set=function(e){e=e||{},this.enableLowpass=!isNullOrUndef(e.enableLowpass)&&e.enableLowpass,this.enableHighpass=!isNullOrUndef(e.enableHighpass)&&e.enableHighpass,this.lowpassFreq=isNullOrUndef(e.lowpassFreq)?120:e.lowpassFreq,this.highpassFreq=isNullOrUndef(e.highpassFreq)?480:e.highpassFreq},Settings.prototype.addSection=function(e){return this.sections.push(new Section(e)),this},Settings.prototype.set=function(e){if(e=e||{},this.smoothingTimeConstant=numberProperty(isNullOrUndef(e.smoothingTimeConstant)?.65:e.smoothingTimeConstant),this.sections=[],Array.isArray(e.sections))for(var t=0;t<e.sections.length;t++)this.addSection(e.sections[t]);this.globalScale=numberProperty(isNullOrUndef(e.globalScale)?1:e.globalScale),this.globalOffsetX=numberProperty(isNullOrUndef(e.globalOffsetX)?0:e.globalOffsetX),this.globalOffsetY=numberProperty(isNullOrUndef(e.globalOffsetY)?0:e.globalOffsetY),this.globalRotation=numberProperty(isNullOrUndef(e.globalRotation)?0:e.globalRotation),this.imageURL=isNullOrUndef(e.imageURL)?"":e.imageURL,this.imageX=numberProperty(isNullOrUndef(e.imageX)?0:e.imageX),this.imageY=numberProperty(isNullOrUndef(e.imageY)?0:e.imageY),this.imageWidth=numberProperty(isNullOrUndef(e.imageWidth)?.4:e.imageWidth),this.imageHeight=numberProperty(isNullOrUndef(e.imageHeight)?.4:e.imageHeight),this.imageBorderRadius=numberProperty(isNullOrUndef(e.imageBorderRadius)?0:e.imageBorderRadius),this.imageRot=numberProperty(isNullOrUndef(e.imageRot)?0:e.imageRot),this.backgroundColor=isNullOrUndef(e.backgroundColor)?"#3b3b3b":e.backgroundColor,this.advanced?this.advanced.set(e.advanced):this.advanced=new AdvancedSettings(e.advanced)};var settingsPresets={Default:(new Settings).addSection(),DubstepGutter:new Settings(JSON.parse('{"smoothingTimeConstant":"0.5","sections":[{"name":"Bass top","visible":true,"minDecibels":"-70","maxDecibels":"-30","barCount":"128","freqStart":"-0.002","freqEnd":"0.02","barsWidth":"1","barsStartX":"-0.55","barsEndX":"0.1","barsY":"0.2","color":"#ffffff","barsPow":"5","barsHeight":"0.05","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"LINES","clampShapeToZero":true,"closeShape":true,"smartFill":false,"drawLast":true,"quadratic":true},{"name":"Bass bottom","visible":true,"minDecibels":"-70","maxDecibels":"-30","barCount":"128","freqStart":"-0.002","freqEnd":"0.02","barsWidth":"1","barsStartX":"0.65","barsEndX":"0.1","barsY":"0.2","color":"#ffffff","barsPow":"5","barsHeight":"0.05","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"LINES","clampShapeToZero":true,"closeShape":true,"smartFill":false,"drawLast":false,"quadratic":true},{"name":"High top","visible":true,"minDecibels":"-70","maxDecibels":"-30","barCount":"128","freqStart":"0.02","freqEnd":"0.035","barsWidth":"1","barsStartX":"1.45","barsEndX":"1.05","barsY":"0.2","color":"#ffffff","barsPow":"3","barsHeight":"0.03","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"LINES","clampShapeToZero":true,"closeShape":true,"smartFill":false,"drawLast":true,"quadratic":true},{"name":"High bottom","visible":true,"minDecibels":"-70","maxDecibels":"-30","barCount":"128","freqStart":"0.02","freqEnd":"0.035","barsWidth":"1","barsStartX":"0.65","barsEndX":"1.05","barsY":"0.2","color":"#ffffff","barsPow":"3","barsHeight":"0.03","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"LINES","clampShapeToZero":true,"closeShape":true,"smartFill":false,"drawLast":true,"quadratic":true}],"globalScale":"max(max((maxlowval + 70) / 50, 0) * 3.8, 1.5)","globalOffsetX":"rand() * max((maxlowval + 70) / 50, 0) * 0.01 - 0.005","globalOffsetY":"rand() * max((maxlowval + 70) / 50, 0) * 0.01 - 0.005","globalRotation":"0","imageURL":"dsg.png","imageX":"0","imageY":"0","imageWidth":"0.405","imageHeight":"0.405","imageBorderRadius":"0.405","imageRot":"0","backgroundColor":"#3b3b3b","advanced":{"enableLowpass":true,"enableHighpass":false,"lowpassFreq":20,"highpassFreq":480}}')),"Drop the Bassline":new Settings(JSON.parse('{"smoothingTimeConstant":"0.5","sections":[{"name":"A section","visible":true,"minDecibels":"-48","maxDecibels":"-20","barCount":"128","freqStart":"0","freqEnd":"0.015","barsWidth":"0.8","barsStartX":"-0.5","barsEndX":"0.5","barsY":"0.4","color":"#ffffff","barsPow":"3","barsHeight":"0.23","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"FILL","clampShapeToZero":false,"closeShape":false,"smartFill":true,"drawLast":true,"quadratic":true},{"name":"A section","visible":true,"minDecibels":"-48","maxDecibels":"-20","barCount":"128","freqStart":"0","freqEnd":"0.015","barsWidth":"0.8","barsStartX":"1.5","barsEndX":"0.5","barsY":"0.4","color":"#ffffff","barsPow":"3","barsHeight":"0.23","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"FILL","clampShapeToZero":false,"closeShape":false,"smartFill":true,"drawLast":true,"quadratic":true},{"name":"A section","visible":true,"minDecibels":"-48","maxDecibels":"-20","barCount":"128","freqStart":"0","freqEnd":"0.015","barsWidth":"0.8","barsStartX":"-0.5","barsEndX":"0.5","barsY":"0.4","color":"#ff0000","barsPow":"3","barsHeight":"0.19","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"FILL","clampShapeToZero":false,"closeShape":false,"smartFill":true,"drawLast":true,"quadratic":true},{"name":"A section","visible":true,"minDecibels":"-48","maxDecibels":"-20","barCount":"128","freqStart":"0","freqEnd":"0.015","barsWidth":"0.8","barsStartX":"1.5","barsEndX":"0.5","barsY":"0.4","color":"#ff0000","barsPow":"3","barsHeight":"0.19","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"FILL","clampShapeToZero":false,"closeShape":false,"smartFill":true,"drawLast":true,"quadratic":true},{"name":"A section","visible":true,"minDecibels":"-48","maxDecibels":"-20","barCount":"128","freqStart":"0","freqEnd":"0.015","barsWidth":"0.8","barsStartX":"-0.5","barsEndX":"0.5","barsY":"0.4","color":"#ffffff","barsPow":"3","barsHeight":"0.15","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"FILL","clampShapeToZero":false,"closeShape":false,"smartFill":true,"drawLast":true,"quadratic":true},{"name":"A section","visible":true,"minDecibels":"-48","maxDecibels":"-20","barCount":"128","freqStart":"0","freqEnd":"0.015","barsWidth":"0.8","barsStartX":"1.5","barsEndX":"0.5","barsY":"0.4","color":"#ffffff","barsPow":"3","barsHeight":"0.15","barsMinHeight":"0.005","glowness":"0","polar":"1","mode":"FILL","clampShapeToZero":false,"closeShape":false,"smartFill":true,"drawLast":true,"quadratic":true}],"globalScale":"max(max((maxlowval + 70) / 50, 0) * 1.2, 0.8)","globalOffsetX":"rand() * max((maxlowval + 70) / 50, 0) * 0.01 - 0.005","globalOffsetY":"rand() * max((maxlowval + 70) / 50, 0) * 0.01 - 0.005","globalRotation":"0","imageURL":"dtb.png","imageX":"0","imageY":"0","imageWidth":"0.8","imageHeight":"0.8","imageBorderRadius":"0.8","imageRot":"0","backgroundColor":"#3b3b3b","advanced":{"enableLowpass":true,"enableHighpass":false,"lowpassFreq":"100","highpassFreq":480}}')),BOD:new Settings(JSON.parse('{"smoothingTimeConstant":"0.65","sections":[{"name":"A section","visible":true,"minDecibels":"-65","maxDecibels":"-10","barCount":"256","freqStart":"0","freqEnd":"0.1","barsWidth":"0.5","barsStartX":"-1","barsEndX":"1","barsY":"0.2","color":"#ff0000","barsPow":"3","barsHeight":"-1","barsMinHeight":"-0.002","glowness":"64","polar":"0","mode":"LINES","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true}],"globalScale":"1","globalOffsetX":"0","globalOffsetY":"0","globalRotation":"0","imageURL":"","imageX":"0","imageY":"0","imageWidth":"0.4","imageHeight":"0.4","imageRot":"0","backgroundColor":"#000000"}'))},settings=new Settings,frameProps={maxval:0,minval:Number.MIN_SAFE_INTEGER,maxlowval:0,minlowval:Number.MIN_SAFE_INTEGER,maxhighval:0,minhighval:Number.MIN_SAFE_INTEGER},refreshControls=function(){var e=null,t=null,a=null,n=null,s=null,r=null,i=null,o=null,l=null,d=null,c=null,u=!1,m=[],h=function(){for(var e=-1,t=0;t<a.children.length;t++)a.children[t].classList.contains("activated")&&(e=t);for(;0!==s.children.length;)s.removeChild(s.children[0]);for(;0!==a.children.length&&a.children[0]!==n;)a.removeChild(a.children[0]);for(var t=0;t<settings.sections.length;t++)w(t);if(e!==-1){for(var t=0;t<m[e].length;t++)s.appendChild(m[e][t]);a.children[e].classList.add("activated")}},f=function(e,t){var a=e[t];if("object"==typeof a&&!a.hasOwnProperty("expr")||"function"==typeof a)return null;var n=document.createElement("li"),s=document.createElement("span"),r=document.createElement("input");if(n.classList.add("settingsCtrl"),s.classList.add("ctrlName"),r.classList.add("ctrlInput"),s.innerHTML=t,"boolean"==typeof a)r.type="checkbox",r.checked=a;else if(t.toLowerCase().endsWith("color"))r.type="color",r.value=a.toString();else{r.type="text",r.placeholder=a.hasOwnProperty("expr")?"expression":typeof a;var i=a.toString();a.hasOwnProperty("expr")?r.value=a.expr:i.startsWith("data:")?r.value="DataURL":r.value=a.toString()}if(r.addEventListener("change",function(){if("number"==typeof e[t]){if(""===this.value)return;e[t]=this.value}else"boolean"==typeof e[t]?e[t]=this.checked:e[t].hasOwnProperty("expr")?e[t].expr=this.value:e[t]=this.value}),n.appendChild(s),n.appendChild(r),"boolean"==typeof a){var o=document.createElement("span");o.classList.add("ctrlCheckbox","fa"),o.addEventListener("click",function(a){e[t]=r.checked=!r.checked}),n.appendChild(o)}return n},g=function(e,t,a){var n=(e[t],document.createElement("li")),s=document.createElement("span"),r=document.createElement("select");n.classList.add("settingsCtrl"),s.classList.add("ctrlName"),r.classList.add("ctrlInput"),s.innerHTML=t;for(var i in a){var o=document.createElement("option");o.value=i,o.innerHTML=i,r.appendChild(o),e[t]===a[i]&&(r.value=i)}return r.addEventListener("change",function(){var n=a[this.value];e[t]=n}),n.appendChild(s),n.appendChild(r),n},p=function(e,t){var n=e[t],s=document.createElement("li"),r=document.createElement("input"),i=document.createElement("ul");s.classList.add("settingsMajorCtrl"),r.classList.add("ctrlMajorInput"),i.classList.add("ctrlOptions"),r.type="text",r.placeholder=t,r.value=n.toString();var o=document.createElement("li"),l=document.createElement("li"),d=document.createElement("li");o.classList.add("fa","fa-clone","w3-large","ctrlOptClone"),l.classList.add("fa","fa-trash-o","w3-large","ctrlOptDelete");var c=document.createElement("i"),u=document.createElement("i");return c.classList.add("fa","fa-angle-right","w3-small","ctrlOptRight"),u.classList.add("fa","fa-angle-left","w3-small","ctrlOptLeft"),d.classList.add("ctrlOptMoves"),d.appendChild(c),d.appendChild(document.createElement("br")),d.appendChild(u),c.addEventListener("click",function(){var t=settings.sections.indexOf(e);if(!(t>=settings.sections.length-1)){var n=settings.sections[t];settings.sections[t]=settings.sections[t+1],settings.sections[t+1]=n,h(),a.children[t+1].click()}}),u.addEventListener("click",function(){var t=settings.sections.indexOf(e);if(!(t<=0)){var n=settings.sections[t];settings.sections[t]=settings.sections[t-1],settings.sections[t-1]=n,h(),a.children[t-1].click()}}),o.addEventListener("click",function(){var t=new Section(e);settings.sections.push(t),w(settings.sections.length-1)}),l.addEventListener("click",function(){var t=settings.sections.indexOf(e);settings.sections.splice(t,1),E(t)}),i.appendChild(d),i.appendChild(o),i.appendChild(l),r.addEventListener("change",function(){e[t]=this.value,a.children[settings.sections.indexOf(e)].title=e[t]}),s.appendChild(r),s.appendChild(i),s},b=function(e){var t=[];for(var a in e){var n=null;n=e[a]instanceof EnumerationValue?g(e,a,e[a].ownerEnum):"name"===a?p(e,a):f(e,a),n&&t.push(n)}return t},v=function(e){if(this!==n&&!this.classList.contains("activated")){for(var t=-1,r=0;r<settings.sections.length;r++)a.children[r]!==this?a.children[r].classList.contains("activated")&&a.children[r].classList.remove("activated"):t=r;for(this.classList.add("activated");0!==s.children.length;)s.removeChild(s.children[0]);for(var r=0;r<m[t].length;r++)s.appendChild(m[t][r])}},w=function(e){var t=document.createElement("li");t.innerHTML=e.toString(),t.title=settings.sections[e].name,t.classList.add("sectionTab"),t.addEventListener("click",v),a.insertBefore(t,n),m[e]=b(settings.sections[e])},E=function(e){var t=a.children[e];t&&(t.removeEventListener("click",v),a.removeChild(t),h())},S=function(){for(;0!==e.children.length;)e.removeChild(e.children[0]);for(var a in settings){var n=f(settings,a);n&&e.appendChild(n)}for(;0!==t.children.length;)t.removeChild(t.children[0]);for(var a in settings.advanced){var n=f(settings.advanced,a);n&&t.appendChild(n)}},L=function(){for(;0!==r.children.length;)r.removeChild(r.children[0]);for(var e in settingsPresets){var t=document.createElement("li");t.innerHTML=e.toString(),t.addEventListener("click",function(){var t=e;return function(){loadPreset(t),h()}}()),r.appendChild(t)}};return function(m){0!==m&&(m||(m=refreshables.SETTINGS_BIT|refreshables.TABS_BIT|refreshables.PRESETLIST_BIT),e||(e=document.getElementById("globalSettings")),t||(t=document.getElementById("advancedSettings")),a||(a=document.getElementById("settingsSectionTabs")),n||(n=document.getElementById("addTab")),s||(s=document.getElementById("sectionSettings")),r||(r=document.getElementById("settingsPresetsList")),i||(i=document.getElementById("presetNameInput")),o||(o=document.getElementById("settingsPresetsOptOpen")),l||(l=document.getElementById("settingsPresetsOptSave")),d||(d=document.getElementById("downloader")),c||(c=document.getElementById("fileChooser")),u||(n.addEventListener("click",function(e){var t=new Section;settings.sections.push(t),w(settings.sections.length-1)}),c.addEventListener("change",function(e){for(var t=0;t<e.target.files.length-1;t++)loadFilePreset(e.target.files[t]);loadFilePreset(e.target.files[e.target.files.length-1],!0)}),o.addEventListener("click",function(e){c.accept=".urm",c.click()}),l.addEventListener("click",function(e){var t=i.value?i.value:"untitled";d.href="data:text/plain;base64,"+btoa(JSON.stringify(settings)),d.download=t+".urm",d.click();for(var a=0;void 0!==settingsPresets[t];)t=(i.value?i.value:"untitled")+" ("+a+")",a++;settingsPresets[t]=new Settings(settings),S(),h(),L()}),u=!0),0!==(m&refreshables.SETTINGS_BIT)&&S(),0!==(m&refreshables.TABS_BIT)&&h(),0!==(m&refreshables.PRESETLIST_BIT)&&L(),a.children[0]&&v.call(a.children[0]))}}();window.onload=function(){function e(e){if(e.type.match("image.*")){var t=new FileReader;t.addEventListener("load",function(e){settings.imageURL=e.target.result,refreshControls(refreshables.SETTINGS_BIT)}),t.readAsDataURL(e)}}function t(e,t){H.src=t,document.title="Urmusic - "+e,H.play(),U.classList.contains("masked")||U.classList.add("masked")}function a(e){if(e.type.match("audio.*")){var a=new FileReader;a.addEventListener("load",function(a){t(e.name.substr(0,e.name.lastIndexOf(".")),a.target.result)}),a.readAsDataURL(e)}}function n(t){for(var n,s,r=0;r<t.length;r++)t[r].type.match("image.*")?n=t[r]:t[r].type.match("audio.*")?s=t[r]:t[r].name.endsWith(".urm")&&loadFilePreset(t[r],r===t.length-1);n&&e(n),s&&a(s)}function s(e,t,a){return e+a*(t-e)}function r(e,t,a){return t<0||t>=e.length?a:e[t]}function i(e,t,a,n){if(a){var i=Math.floor(t+.5);return d(s(r(e,i-1,n),r(e,i,n),.5),r(e,i,n),s(r(e,i,n),r(e,i+1,n),.5),t-i+.5)}var o=Math.floor(t),l=Math.ceil(t),c=r(e,o,n),u=r(e,l,n);return s(c,u,t-o)}function o(e){var t={};for(var a in e){var n=e[a];"object"==typeof n&&n.hasOwnProperty("expr")?t[a]=n.value:t[a]=n}return t}function l(e,t){return Math.max(i(S,s(t.freqStart,t.freqEnd,e)*S.length,t.quadratic,t.minDecibels)-t.minDecibels,0)/(t.maxDecibels-t.minDecibels)}function d(e,t,a,n){var s=(1-n)*(1-n)*e+2*(1-n)*n*t+n*n*a;return s}function c(){if(E.smoothingTimeConstant=settings.smoothingTimeConstant.value,y.smoothingTimeConstant=settings.smoothingTimeConstant.value,C.smoothingTimeConstant=settings.smoothingTimeConstant.value,!S&&(S=new Float32Array(E.frequencyBinCount),H.paused))for(var e=0;e<S.length;e++)S[e]=Number.MIN_SAFE_INTEGER;if(settings.advanced.enableLowpass&&!P&&(P=new Float32Array(y.frequencyBinCount),H.paused))for(var e=0;e<P.length;e++)P[e]=Number.MIN_SAFE_INTEGER;if(settings.advanced.enableHighpass&&!N&&(N=new Float32Array(C.frequencyBinCount),H.paused))for(var e=0;e<N.length;e++)N[e]=Number.MIN_SAFE_INTEGER;H.paused||(E.getFloatFrequencyData(S),settings.advanced.enableLowpass&&y.getFloatFrequencyData(P),settings.advanced.enableHighpass&&C.getFloatFrequencyData(N)),I.width==I.clientWidth&&I.height==I.clientHeight||(I.width=I.clientWidth,I.height=I.clientHeight),frameProps.minval=Math.min.apply(Math,S),frameProps.maxval=Math.max.apply(Math,S),frameProps.time=H.currentTime,frameProps.duration=H.duration,settings.advanced.enableLowpass&&(frameProps.maxlowval=Math.max.apply(Math,P),frameProps.minlowval=Math.min.apply(Math,P)),settings.advanced.enableHighpass&&(frameProps.maxhighval=Math.max.apply(Math,N),frameProps.minhighval=Math.min.apply(Math,N)),h(),x(c)}function u(e,t,a,n){var r=s(a.barsStartX,a.barsEndX,n),i=a.barsY;if(a.polar>0){var o=Math.cos((.5*r+.5)*Math.PI*2),l=Math.sin((.5*r+.5)*Math.PI*2),d=o*i,c=l*i;r=s(r*e,d*e,a.polar),i=s(i*t,c*t,a.polar)}else r*=e,i*=t;return{x:r,y:i}}function m(e,t,a,n){var r=Math.pow(l(n,a),a.barsPow)*a.barsHeight,i=s(a.barsStartX,a.barsEndX,n),o=a.barsY,d=o+a.barsMinHeight+r,c=i;if(a.polar>0){var u=Math.cos((.5*i+.5)*Math.PI*2),m=Math.sin((.5*i+.5)*Math.PI*2),h=u*o,f=m*o,g=u*d,p=m*d;i=s(i*e,h*e,a.polar),o=s(o*t,f*t,a.polar),c=s(c*e,g*e,a.polar),d=s(d*t,p*t,a.polar)}else i*=e,o*=t,c*=e,d*=t;return{x:i,y:o,ex:c,ey:d}}function h(){var e=I.width/I.height,t=I.width,a=I.height;t>a?t/=e:a*=e,T.clearRect(0,0,I.width,I.height),T.fillStyle=settings.backgroundColor,T.fillRect(0,0,I.width,I.height),T.save(),T.translate(I.width/2,I.height/2),T.scale(.5,-.5);var n=settings.globalScale.value;T.scale(n,n),T.translate(settings.globalOffsetX.value*t,settings.globalOffsetY.value*a),T.rotate(settings.globalRotation.value);for(var s=0;s<settings.sections.length;s++){var r=o(settings.sections[s]),i=r.mode,l=r.barCount;if(r.visible){T.strokeStyle=r.color,T.fillStyle=r.color,T.lineWidth=r.barsWidth/100*Math.min(I.width,I.height),T.shadowColor=r.color,T.shadowBlur=r.glowness*n,T.beginPath();for(var d=0;d<l&&(r.drawLast||d!==l-1);d++){var c=d/(l-1),h=m(t,a,r,c);(i==drawMode.LINES||0==d&&r.clampShapeToZero)&&T.moveTo(h.x,h.y),T.lineTo(h.ex,h.ey),d==l-1&&r.clampShapeToZero&&T.lineTo(h.x,h.y)}if(r.closeShape&&i===drawMode.OUTLINE&&T.closePath(),i===drawMode.FILL){if(r.smartFill)for(var d=l-1;d>=0;d--)if(r.drawLast||d!==l-1){var c=d/(l-1),f=u(t,a,r,c);T.lineTo(f.x,f.y)}T.fill()}else T.stroke()}}if(F){T.shadowColor="rgba(0, 0, 0, 0)",T.shadowBlur=0;var g=settings.imageWidth.value,p=settings.imageHeight.value;T.scale(1,-1),T.rotate(settings.imageRot.value);var b=settings.imageBorderRadius.value*t;0!==b?(T.save(),T.roundRect((settings.imageX.value-g/2)*t,(settings.imageY.value-p/2)*a,g*t,p*a,b),T.clip(),T.drawImage(_,(settings.imageX.value-g/2)*t,(settings.imageY.value-p/2)*a,g*t,p*a),T.restore()):T.drawImage(_,(settings.imageX.value-g/2)*t,(settings.imageY.value-p/2)*a,g*t,p*a)}T.restore()}function f(){navigator.userAgent.indexOf("Firefox/")===-1&&(B.style.marginRight="0px")}function g(){SC.initialize({client_id:q});var e=document.getElementById("soundcloudApp").parentNode.getElementsByClassName("appLinkInput")[0],a=e.parentNode.parentNode;e.addEventListener("change",function(){a.classList.add("loading"),SC.resolve(this.value).then(function(e){var n=new XMLHttpRequest;n.onload=function(n){t(e.title+" (SoundCloud)",n.target.responseURL),a.classList.remove("loading")},n.open("GET",e.stream_url+"?client_id="+q),n.send()},function(){a.classList.remove("loading")})})}function p(){for(var e={lines:8,length:0,width:14,radius:19,scale:.3,corners:1,color:"#fff",opacity:0,rotate:90,direction:1,speed:1.5,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!0,position:"absolute"},t=document.getElementsByClassName("musicAppIcon"),a=0;a<t.length;a++){var n=document.createElement("div"),s=document.createElement("div"),r=document.createElement("input"),i=document.createElement("i"),o=t[a],l=o.parentNode;l.removeChild(o),n.classList.add("musicAppIconContainer"),n.appendChild(o),l.appendChild(n),r.placeholder="Paste a link...",s.appendChild(r),s.appendChild(i),s.classList.add("appLinkForm"),r.classList.add("appLinkInput"),i.classList.add("loadIcon"),new Spinner(e).spin(i),n.appendChild(s),o.addEventListener("click",function(){n.classList.contains("activated")?n.classList.remove("activated"):n.classList.add("activated")})}g()}function b(){if(!I||!T||!M)throw alert("Your browser isn't compatible"),new Error("Couldn't initialize");v=M.createMediaElementSource(H),w=M.createGain(),E=M.createAnalyser(),E.fftSize=2048,L=M.createBiquadFilter(),L.type="lowpass",y=M.createAnalyser(),y.fftSize=2048,O=M.createBiquadFilter(),O.type="highpass",C=M.createAnalyser(),C.fftSize=2048,I.width=document.body.clientWidth,I.height=document.body.clientHeight,I.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},!1),I.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),n(e.dataTransfer.files)},!1),localStorage.urmusic_volume?H.volume=localStorage.urmusic_volume:localStorage.urmusic_volume=H.volume,H.addEventListener("volumechange",function(e){w.gain.value=0===H.volume?0:1/H.volume,localStorage.urmusic_volume=H.volume}),H.crossOrigin="anonymous";var e=document.getElementById("settingsNav"),t=document.getElementById("presetMenuOpenCloseBtn"),a=document.getElementById("settingsPresetsMenu");document.getElementById("hambParent").addEventListener("click",function(n){e.classList.contains("activated")?e.classList.remove("activated"):e.classList.add("activated"),e.classList.contains("activated")||(a.classList.remove("opened"),t.classList.remove("opened"))}),t.addEventListener("click",function(){this.classList.contains("opened")?(this.classList.remove("opened"),a.classList.remove("opened")):(this.classList.add("opened"),a.classList.add("opened"))}),R.addEventListener("click",function(){B.style.marginRight=""}),w.gain.value=0===H.volume?0:1/H.volume,L.connect(y),O.connect(C),v.connect(w),w.connect(E),w.connect(L),w.connect(O),v.connect(M.destination),_.addEventListener("load",function(){F=!0}),settings.watch("imageURL",function(e,t,a){return F=!1,_.src=a,a}),settings.advanced.watch("lowpassFreq",function(e,t,a){return L.frequency.value=a,a}),settings.advanced.watch("highpassFreq",function(e,t,a){return O.frequency.value=a,a}),settings.advanced.lowpassFreq=settings.advanced.lowpassFreq,settings.advanced.highpassFreq=settings.advanced.highpassFreq,p(),console.log(" _    _ ________     __  _ \n| |  | |  ____\\ \\   / / | |\tHey you! This app is highly customizable through the JavaScript\n| |__| | |__   \\ \\_/ /  | |\tconsole too! Have fun, and try not to broke everything :p!\n|  __  |  __|   \\   /   | |\t\n| |  | | |____   | |    |_|\tUrmusic V1.1\n|_|  |_|______|  |_|    (_)\tBy Nasso (https://nasso.github.io/)\n\n"),loadPreset(),c(),f()}var v,w,E,S,L,y,P,O,C,N,x=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},I=document.getElementById("cvs"),T=I.getContext("2d"),M=new AudioContext,q="09bfcfe5b0303000a41b9e9675c0cb47",F=!1,_=new Image,H=document.getElementById("audioElement"),U=document.getElementById("helpNav"),B=document.getElementById("firefoxIsBetter"),R=B.getElementsByClassName("close")[0];b()};