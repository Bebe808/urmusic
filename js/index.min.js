function lerp(e,t,n){return e+n*(t-e)}function prettyTime(e){e=e||0;var t=e%60|0,n=e/60%60|0,a=e/3600|0;return a?a+":"+("0"+n).substr(-2)+":"+("0"+t).substr(-2):n+":"+("0"+t).substr(-2)}function isNullOrUndef(e){return null===e||void 0===e}function EnumerationValue(e,t){this.name=t,this.ownerEnum=e}function Enumeration(e){if(!Array.isArray(e))throw new Error("No values specified for the Enumeration");for(var t=0;t<e.length;t++)this[e[t]]=new EnumerationValue(this,e[t])}function clamp(e,t,n){return Math.max(Math.min(e,n),t)}function ExpressionProperty(e){e||(e=0),e instanceof ExpressionProperty&&(e=e.expr);var t=e.toString(),n=new Function(exprArgs.join(","),"return ("+t+")"),a=+t;Object.defineProperty(this,"value",{get:function(){if(!Number.isNaN(a))return a;try{return n(null,null,null,Math.random,smoothrand,Math.max,Math.min,clamp,Math.floor,Math.ceil,Math.cos,Math.sin,Math.tan,Math.acos,Math.asin,Math.atan,Math.pow,Math.PI,frameProps.maxval,frameProps.minval,frameProps.time,frameProps.duration,frameProps.maxlowval,frameProps.minlowval,frameProps.maxhighval,frameProps.minhighval,frameProps.csize,frameProps.imgw,frameProps.imgh,frameProps.imgr,currentSongTitle,frameProps.prettytime,frameProps.prettyduration)}catch(e){return 0}}}),Object.defineProperty(this,"expr",{get:function(){return t},set:function(e){""===e&&(e="0"),t=e,a=+e,Number.isNaN(a)&&(n=new Function(exprArgs.join(","),"return ("+t+")"))}})}function AdvancedSettings(e){this.set(e)}function AnalyserSection(e){e=e||{},this.dataCount=new ExpressionProperty(isNullOrUndef(e.dataCount)?128:e.dataCount),this.lineWidth=new ExpressionProperty(isNullOrUndef(e.lineWidth)?1:e.lineWidth),this.lineCap=isNullOrUndef(e.lineCap)?lineCapMode.BUTT:lineCapMode[e.lineCap],this.startX=new ExpressionProperty(isNullOrUndef(e.startX)?-1:e.startX),this.endX=new ExpressionProperty(isNullOrUndef(e.endX)?1:e.endX),this.yPos=new ExpressionProperty(isNullOrUndef(e.yPos)?0:e.yPos),this.exponent=new ExpressionProperty(isNullOrUndef(e.exponent)?1:e.exponent),this.height=new ExpressionProperty(isNullOrUndef(e.height)?.5:e.height),this.mode=isNullOrUndef(e.mode)?drawMode.LINES:drawMode[e.mode],this.polar=new ExpressionProperty(isNullOrUndef(e.polar)?0:e.polar),this.clampShapeToZero=!!isNullOrUndef(e.clampShapeToZero)||e.clampShapeToZero,this.closeShape=!!isNullOrUndef(e.closeShape)||e.closeShape,this.drawLast=!!isNullOrUndef(e.drawLast)||e.drawLast,this.quadratic=!!isNullOrUndef(e.quadratic)||e.quadratic}function FreqSection(e){AnalyserSection.call(this,e),e=e||{},this.minDecibels=new ExpressionProperty(isNullOrUndef(e.minDecibels)?-100:e.minDecibels),this.maxDecibels=new ExpressionProperty(isNullOrUndef(e.maxDecibels)?-20:e.maxDecibels),this.minHeight=new ExpressionProperty(isNullOrUndef(e.minHeight)?.01:e.minHeight),this.freqStart=new ExpressionProperty(isNullOrUndef(e.freqStart)?0:e.freqStart),this.freqEnd=new ExpressionProperty(isNullOrUndef(e.freqEnd)?.03:e.freqEnd),this.smartFill=!isNullOrUndef(e.smartFill)&&e.smartFill}function TimeDomSection(e){AnalyserSection.call(this,e),e=e||{},this.lineJoin=isNullOrUndef(e.lineJoin)?lineJoinMode.ROUND:lineJoinMode[e.lineJoin]}function ImageSection(e){e=e||{},this.imageURL=isNullOrUndef(e.imageURL)?"":e.imageURL,this.imageBorderRadius=new ExpressionProperty(isNullOrUndef(e.imageBorderRadius)?0:e.imageBorderRadius);var t=this;this.image=new Image;var n=!1;this.image.onload=function(){n=!0},Object.defineProperty(this,"imageReady",{get:function(){return n}}),this.watch("imageURL",function(e,a,i){return n=!1,t.image.src=i,i}),this.image.src=this.imageURL}function TextSection(e){e=e||{},this.text=new ExpressionProperty(isNullOrUndef(e.text)?'"Type your text here"':e.text),this.fontStyle=isNullOrUndef(e.fontStyle)?"normal":e.fontStyle,this.fontSize=new ExpressionProperty(isNullOrUndef(e.fontSize)?.2:e.fontSize),this.fontFamily=isNullOrUndef(e.fontFamily)?"sans-serif":e.fontFamily,this.textAlign=isNullOrUndef(e.textAlign)?textAlignMode.CENTER:textAlignMode[e.textAlign],this.textBaseline=isNullOrUndef(e.textBaseline)?textBaselineMode.ALPHABETIC:textBaselineMode[e.textBaseline]}function Section(e){e=e||{},this.name=isNullOrUndef(e.name)?"A section":e.name,this.type=isNullOrUndef(e.type)?sectionType.FREQ:sectionType[e.type],this.visible=!!isNullOrUndef(e.visible)||e.visible,this.opacity=new ExpressionProperty(isNullOrUndef(e.opacity)?1:e.opacity),this.posX=new ExpressionProperty(isNullOrUndef(e.posX)?0:e.posX),this.posY=new ExpressionProperty(isNullOrUndef(e.posY)?0:e.posY),this.rotation=new ExpressionProperty(isNullOrUndef(e.rotation)?0:e.rotation),this.scaleX=new ExpressionProperty(isNullOrUndef(e.scaleX)?1:e.scaleX),this.scaleY=new ExpressionProperty(isNullOrUndef(e.scaleY)?1:e.scaleY),this.color=isNullOrUndef(e.color)?"#ffffff":e.color,this.glowness=new ExpressionProperty(isNullOrUndef(e.glowness)?0:e.glowness),this.target=null,this.type===sectionType.FREQ?this.target=new FreqSection(e.target?e.target:e):this.type===sectionType.TIME_DOM?this.target=new TimeDomSection(e.target?e.target:e):this.type===sectionType.IMAGE?this.target=new ImageSection(e.target?e.target:e):this.type===sectionType.TEXT&&(this.target=new TextSection(e.target?e.target:e));var t=this;this.watch("type",function(e,n,a){return n instanceof EnumerationValue&&n.ownerEnum===sectionType&&a!==n?(a===sectionType.FREQ?t.target=new FreqSection(t.target):a===sectionType.TIME_DOM?t.target=new TimeDomSection(t.target):a===sectionType.IMAGE?t.target=new ImageSection(t.target):a===sectionType.TEXT&&(t.target=new TextSection(t.target)),refreshControls(refreshables.TABS_BIT),a):n})}function Settings(e){this.set(e)}function loadPreset(e){if(isNullOrUndef(e)){var t=[];for(var n in settingsPresets)t.push(n);e=t[Math.floor(Math.random()*t.length)]}settings.set(settingsPresets[e]),refreshControls()}function loadFilePreset(e,t){if(e){var n=e.name.substr(0,e.name.lastIndexOf(".")),a=new FileReader;a.onload=function(e){for(var a=new Settings(JSON.parse(e.target.result)),i=n,s=0;void 0!==settingsPresets[i];)i=n+" ("+s+")",s++;settingsPresets[i]=a,t&&loadPreset(i)},a.readAsText(e)}}Object.prototype.watch||Object.defineProperty(Object.prototype,"watch",{enumerable:!1,configurable:!0,writable:!1,value:function(e,t){var n=this[e],a=n,i=function(){return a},s=function(i){return n=a,a=t.call(this,e,n,i)};delete this[e]&&Object.defineProperty(this,e,{get:i,set:s,enumerable:!0,configurable:!0})}}),Object.prototype.unwatch||Object.defineProperty(Object.prototype,"unwatch",{enumerable:!1,configurable:!0,writable:!1,value:function(e){var t=this[e];delete this[e],this[e]=t}});var smoothrand=function(){var e=[],t=0,n=0;return function(a){return a=a<0?-a:a,t=0|a,n=a+1|0,isNullOrUndef(e[t])&&(e[t]=Math.random()),isNullOrUndef(e[n])&&(e[n]=Math.random()),lerp(e[t],e[n],Math.cos((a-t)*-1*Math.PI)*-.5+.5)}}();CanvasRenderingContext2D.prototype.roundRect=function(e,t,n,a,i){return i=Math.max(i,0),0===i?(this.beginPath(),void this.rect(e,t,n,a)):(n<2*i&&(i=n/2),a<2*i&&(i=a/2),this.beginPath(),this.moveTo(e+i,t),this.arcTo(e+n,t,e+n,t+a,i),this.arcTo(e+n,t+a,e,t+a,i),this.arcTo(e,t+a,e,t,i),this.arcTo(e,t,e+n,t,i),void this.closePath())},EnumerationValue.prototype.toJSON=function(){return this.name},EnumerationValue.prototype.toString=EnumerationValue.prototype.toJSON;var AudioContext=window.AudioContext||window.webkitAudioContext,drawMode=new Enumeration(["LINES","FILL","OUTLINE"]),sectionType=new Enumeration(["FREQ","TIME_DOM","IMAGE","TEXT"]),lineCapMode=new Enumeration(["BUTT","ROUND","SQUARE"]),lineJoinMode=new Enumeration(["MITER","ROUND","BEVEL"]),textAlignMode=new Enumeration(["LEFT","CENTER","RIGHT"]),textBaselineMode=new Enumeration(["TOP","HANGING","MIDDLE","ALPHABETIC","IDEOGRAPHIC","BOTTOM"]),refreshables={SETTINGS_BIT:1,TABS_BIT:2,PRESETLIST_BIT:4},exprArgs=["alert","window","navigator","rand","smoothrand","max","min","clamp","floor","ceil","cos","sin","tan","acos","asin","atan","pow","pi","maxval","minval","time","duration","maxlowval","minlowval","maxhighval","minhighval","csize","imgw","imgh","imgr","songtitle","prettytime","prettyduration"],frameProps={maxval:0,minval:Number.MIN_SAFE_INTEGER,maxlowval:0,minlowval:Number.MIN_SAFE_INTEGER,maxhighval:0,minhighval:Number.MIN_SAFE_INTEGER,csize:0,imgw:0,imgh:0,imgr:0,time:0,duration:0,prettytime:"0:00",prettyduration:"0:00"},currentSongTitle="Silence";ExpressionProperty.prototype.toJSON=function(){return this.expr},AdvancedSettings.prototype.set=function(e){e=e||{},this.enableLowpass=!isNullOrUndef(e.enableLowpass)&&e.enableLowpass,this.enableHighpass=!isNullOrUndef(e.enableHighpass)&&e.enableHighpass,this.lowpassFreq=isNullOrUndef(e.lowpassFreq)?120:+e.lowpassFreq,this.highpassFreq=isNullOrUndef(e.highpassFreq)?480:+e.highpassFreq,this.lowpassSmooth=isNullOrUndef(e.lowpassSmooth)?.65:+e.lowpassSmooth,this.highpassSmooth=isNullOrUndef(e.highpassSmooth)?.65:+e.highpassSmooth},Settings.prototype={addSection:function(e){return this.sections.push(new Section(e)),this},set:function(e){if(e=e||{},this.smoothingTimeConstant=new ExpressionProperty(isNullOrUndef(e.smoothingTimeConstant)?.65:e.smoothingTimeConstant),this.sections=[],Array.isArray(e.sections))for(var t=0;t<e.sections.length;t++)this.addSection(e.sections[t]);this.globalScale=new ExpressionProperty(isNullOrUndef(e.globalScale)?1:e.globalScale),this.globalOffsetX=new ExpressionProperty(isNullOrUndef(e.globalOffsetX)?0:e.globalOffsetX),this.globalOffsetY=new ExpressionProperty(isNullOrUndef(e.globalOffsetY)?0:e.globalOffsetY),this.globalRotation=new ExpressionProperty(isNullOrUndef(e.globalRotation)?0:e.globalRotation),this.backgroundColor=isNullOrUndef(e.backgroundColor)?"#3b3b3b":e.backgroundColor,this.advanced?this.advanced.set(e.advanced):this.advanced=new AdvancedSettings(e.advanced)}};var settingsPresets={Default:(new Settings).addSection(),"Time domain default":new Settings(JSON.parse('{"smoothingTimeConstant":"0.65","sections":[{"name":"A section","type":"TIME_DOM","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"256","lineWidth":"1","lineCap":"BUTT","polar":"0","lineJoin":"ROUND","startX":"-1","endX":"1","yPos":"0","exponent":"1","height":"0.5","mode":"OUTLINE","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true}}],"globalScale":"1","globalOffsetX":"0","globalOffsetY":"0","globalRotation":"0","backgroundColor":"#3b3b3b","advanced":{"enableLowpass":false,"enableHighpass":false,"lowpassFreq":120,"highpassFreq":480}}')),DubstepGutter:new Settings(JSON.parse('{"smoothingTimeConstant":"0.5","sections":[{"name":"Bass top","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"1","lineCap":"ROUND","startX":"-0.55","endX":"0.1","yPos":"0.2","exponent":"5","height":"0.05","mode":"LINES","polar":"1","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true,"minDecibels":"-70","maxDecibels":"-30","minHeight":"0","freqStart":"-0.002","freqEnd":"0.02","smartFill":false}},{"name":"Bass bottom","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"1","lineCap":"ROUND","startX":"0.65","endX":"0.1","yPos":"0.2","exponent":"5","height":"0.05","mode":"LINES","polar":"1","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true,"minDecibels":"-70","maxDecibels":"-30","minHeight":"0","freqStart":"-0.002","freqEnd":"0.02","smartFill":false}},{"name":"High top","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"1","lineCap":"ROUND","startX":"1.45","endX":"1.05","yPos":"0.2","exponent":"3","height":"0.03","mode":"FILL","polar":"1","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true,"minDecibels":"-70","maxDecibels":"-30","minHeight":"0","freqStart":"0.02","freqEnd":"0.035","smartFill":false}},{"name":"High bottom","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"1","lineCap":"ROUND","startX":"0.65","endX":"1.05","yPos":"0.2","exponent":"3","height":"0.03","mode":"FILL","polar":"1","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true,"minDecibels":"-70","maxDecibels":"-30","minHeight":"0","freqStart":"0.02","freqEnd":"0.035","smartFill":false}},{"name":"Image","type":"IMAGE","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"0.41","scaleY":"0.41","color":"#ffffff","glowness":"0","target":{"imageURL":"dsg.png","imageBorderRadius":"0.5","image":{}}}],"globalScale":"max(max((maxlowval + 70) / 50, 0) * 3.8, 1.5)","globalOffsetX":"0.01 * (rand() * 2 - 1) * clamp((maxlowval + 70) / 50, 0, 1)","globalOffsetY":"0.01 * (rand() * 2 - 1) * clamp((maxlowval + 70) / 50, 0, 1)","globalRotation":"0","backgroundColor":"#3b3b3b","advanced":{"enableLowpass":true,"enableHighpass":false,"lowpassFreq":20,"highpassFreq":480,"lowpassSmooth":0.8,"highpassSmooth":0.8}}')),"Drop the Bassline":new Settings(JSON.parse('{"smoothingTimeConstant":"0.5","sections":[{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"-0.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.23","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"0","freqEnd":"0.015","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"1.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.23","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"0","freqEnd":"0.015","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ff0000","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"-0.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.19","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"0","freqEnd":"0.015","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ff0000","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"1.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.19","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"0","freqEnd":"0.015","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"-0.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.15","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"0","freqEnd":"0.015","smartFill":true}},{"name":"A section","type":"FREQ","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"1","scaleY":"1","color":"#ffffff","glowness":"0","target":{"dataCount":"128","lineWidth":"0.8","lineCap":"BUTT","startX":"1.5","endX":"0.5","yPos":"0.4","exponent":"3","height":"0.15","mode":"FILL","polar":"1","clampShapeToZero":false,"closeShape":false,"drawLast":true,"quadratic":true,"minDecibels":"-48","maxDecibels":"-20","minHeight":"0.002","freqStart":"0","freqEnd":"0.015","smartFill":true}},{"name":"A section","type":"IMAGE","visible":true,"opacity":"1","posX":"0","posY":"0","rotation":"0","scaleX":"0.8","scaleY":"0.8","color":"#ffffff","glowness":"0","target":{"imageURL":"dtb.png","imageBorderRadius":"0.5","image":{}}}],"globalScale":"max(max((maxlowval + 70) / 50, 0) * 1.2, 0.8)","globalOffsetX":"0.01 * (rand() * 2 - 1) * clamp((maxlowval + 70) / 50, 0, 1)","globalOffsetY":"0.01 * (rand() * 2 - 1) * clamp((maxlowval + 70) / 50, 0, 1)","globalRotation":"0","backgroundColor":"#3b3b3b","advanced":{"enableLowpass":true,"enableHighpass":false,"lowpassFreq":100,"highpassFreq":480,"lowpassSmooth":0.8,"highpassSmooth":0.8}}')),BOD:new Settings(JSON.parse('{"smoothingTimeConstant":"0.65","sections":[{"name":"A section","visible":true,"minDecibels":"-65","maxDecibels":"-10","dataCount":"256","freqStart":"0","freqEnd":"0.1","lineWidth":"0.5","startX":"-1","endX":"1","yPos":"0.2","color":"#ff0000","exponent":"3","height":"-1","minHeight":"-0.002","glowness":"64","polar":"0","mode":"LINES","clampShapeToZero":true,"closeShape":true,"drawLast":true,"quadratic":true}],"globalScale":"1","globalOffsetX":"0","globalOffsetY":"0","globalRotation":"0","imageURL":"","imageX":"0","imageY":"0","imageWidth":"0.4","imageHeight":"0.4","imageRot":"0","backgroundColor":"#000000"}'))},settings=new Settings,activeSection=null,refreshControls=function(){var e=null,t=null,n=null,a=null,i=null,s=null,o=null,r=null,l=null,c=null,d=null,p=!1,u=[],h=function(){for(var e=-1,t=0;t<n.children.length;t++)n.children[t].classList.contains("activated")&&(e=t);for(;0!==i.children.length;)i.removeChild(i.children[0]);for(;0!==n.children.length&&n.children[0]!==a;)n.removeChild(n.children[0]);for(var t=0;t<settings.sections.length;t++)w(t);if(e!==-1){for(var t=0;t<u[e].length;t++)i.appendChild(u[e][t]);n.children.length>1?(n.children[Math.min(e,n.children.length-2)].classList.add("activated"),activeSection=settings.sections[Math.min(e,n.children.length-2)]):activeSection=null}else activeSection=null},m=function(e,t){var n=e[t];if(isNullOrUndef(n)&&(n=""),"object"==typeof n&&!n.hasOwnProperty("expr")||"function"==typeof n)return null;var a=document.createElement("li"),i=document.createElement("span"),s=document.createElement("input");if(a.classList.add("settingsCtrl"),i.classList.add("ctrlName"),s.classList.add("ctrlInput"),i.innerHTML=t,"boolean"==typeof n)s.type="checkbox",s.checked=n;else if(t.toLowerCase().endsWith("color"))s.type="color",s.value=n.toString();else{s.type="text",s.placeholder=n instanceof ExpressionProperty?"expression":typeof n;var o=n.toString();n instanceof ExpressionProperty?s.value=n.expr:o.startsWith("data:")?s.value="DataURL":s.value=n.toString()}if(s.addEventListener("change",function(){if("number"==typeof e[t]){if(""===this.value)return;e[t]=this.value}else"boolean"==typeof e[t]?e[t]=this.checked:e[t].hasOwnProperty("expr")?e[t].expr=this.value:e[t]=this.value}),a.appendChild(i),a.appendChild(s),"boolean"==typeof n){var r=document.createElement("span");r.classList.add("ctrlCheckbox","fa"),r.addEventListener("click",function(n){e[t]=s.checked=!s.checked}),a.appendChild(r)}return a},f=function(e,t,n){var a=(e[t],document.createElement("li")),i=document.createElement("span"),s=document.createElement("select");a.classList.add("settingsCtrl"),i.classList.add("ctrlName"),s.classList.add("ctrlInput"),i.innerHTML=t;for(var o in n){var r=document.createElement("option");r.value=o,r.innerHTML=o,s.appendChild(r),e[t]===n[o]&&(s.value=o)}return s.addEventListener("change",function(){var a=n[this.value];e[t]=a}),a.appendChild(i),a.appendChild(s),a},g=function(e,t){var a=e[t],i=document.createElement("li"),s=document.createElement("input"),o=document.createElement("ul");i.classList.add("settingsMajorCtrl"),s.classList.add("ctrlMajorInput"),o.classList.add("ctrlOptions"),s.type="text",s.placeholder=t,s.value=a.toString();var r=document.createElement("li"),l=document.createElement("li"),c=document.createElement("li");r.classList.add("fa","fa-clone","w3-large","ctrlOptClone"),l.classList.add("fa","fa-trash-o","w3-large","ctrlOptDelete");var d=document.createElement("i"),p=document.createElement("i");return d.classList.add("fa","fa-angle-right","w3-small","ctrlOptRight"),p.classList.add("fa","fa-angle-left","w3-small","ctrlOptLeft"),c.classList.add("ctrlOptMoves"),c.appendChild(d),c.appendChild(document.createElement("br")),c.appendChild(p),d.addEventListener("click",function(){var t=settings.sections.indexOf(e);if(!(t>=settings.sections.length-1)){var a=settings.sections[t];settings.sections[t]=settings.sections[t+1],settings.sections[t+1]=a,h(),n.children[t+1].click()}}),p.addEventListener("click",function(){var t=settings.sections.indexOf(e);if(!(t<=0)){var a=settings.sections[t];settings.sections[t]=settings.sections[t-1],settings.sections[t-1]=a,h(),n.children[t-1].click()}}),r.addEventListener("click",function(){var t=new Section(e);settings.sections.push(t),w(settings.sections.length-1)}),l.addEventListener("click",function(){var t=settings.sections.indexOf(e);settings.sections.splice(t,1),E(t)}),o.appendChild(c),o.appendChild(r),o.appendChild(l),s.addEventListener("change",function(){e[t]=this.value,n.children[settings.sections.indexOf(e)].title=e[t]}),i.appendChild(s),i.appendChild(o),i},v=function(){function e(e){for(var n in e){var a=null;a=e[n]instanceof EnumerationValue?f(e,n,e[n].ownerEnum):"name"===n?g(e,n):m(e,n),a&&t.push(a)}}var t=null;return function(n){return t=[],e(n),e(n.target),t}}(),y=function(){if(this!==a&&!this.classList.contains("activated")){for(var e=-1,t=0;t<settings.sections.length;t++)n.children[t]!==this?n.children[t].classList.contains("activated")&&n.children[t].classList.remove("activated"):e=t;for(this.classList.add("activated");0!==i.children.length;)i.removeChild(i.children[0]);for(var t=0;t<u[e].length;t++)i.appendChild(u[e][t]);activeSection=settings.sections[e]}},w=function(e){var t=document.createElement("li");t.innerHTML=e.toString(),t.title=settings.sections[e].name,t.classList.add("sectionTab"),t.addEventListener("click",y),n.insertBefore(t,a),u[e]=v(settings.sections[e])},E=function(e){var t=n.children[e];t&&(t.removeEventListener("click",y),n.removeChild(t),h())},S=function(){for(;0!==e.children.length;)e.removeChild(e.children[0]);for(var n in settings){var a=m(settings,n);a&&e.appendChild(a)}for(;0!==t.children.length;)t.removeChild(t.children[0]);for(var n in settings.advanced){var a=m(settings.advanced,n);a&&t.appendChild(a)}},b=function(){for(;0!==s.children.length;)s.removeChild(s.children[0]);for(var e in settingsPresets){var t=document.createElement("li");t.innerHTML=e.toString(),t.addEventListener("click",function(){var t=e;return function(){loadPreset(t),h()}}()),s.appendChild(t)}};return function(u){0!==u&&(u||(u=refreshables.SETTINGS_BIT|refreshables.TABS_BIT|refreshables.PRESETLIST_BIT),e||(e=document.getElementById("globalSettings")),t||(t=document.getElementById("advancedSettings")),n||(n=document.getElementById("settingsSectionTabs")),a||(a=document.getElementById("addTab")),i||(i=document.getElementById("sectionSettings")),s||(s=document.getElementById("settingsPresetsList")),o||(o=document.getElementById("presetNameInput")),r||(r=document.getElementById("settingsPresetsOptOpen")),l||(l=document.getElementById("settingsPresetsOptSave")),c||(c=document.getElementById("downloader")),d||(d=document.getElementById("fileChooser")),0!==(u&refreshables.SETTINGS_BIT)&&S(),0!==(u&refreshables.TABS_BIT)&&h(),0!==(u&refreshables.PRESETLIST_BIT)&&b(),p||(a.addEventListener("click",function(){var e=new Section;settings.sections.push(e),w(settings.sections.length-1)}),d.addEventListener("change",function(e){for(var t=0;t<e.target.files.length-1;t++)loadFilePreset(e.target.files[t]);loadFilePreset(e.target.files[e.target.files.length-1],!0)}),r.addEventListener("click",function(){d.accept=".urm",d.click()}),l.addEventListener("click",function(){var e=o.value?o.value:"untitled";c.href="data:text/plain;base64,"+btoa(JSON.stringify(settings)),c.download=e+".urm",c.click();for(var t=0;void 0!==settingsPresets[e];)e=(o.value?o.value:"untitled")+" ("+t+")",t++;settingsPresets[e]=new Settings(settings),S(),h(),b()}),n.children.length>1&&y.call(n.children[0]),p=!0))}}();window.addEventListener("load",function(){function e(e){if(e.type.match("image.*")&&activeSection&&activeSection.type===sectionType.IMAGE){var t=new FileReader;t.addEventListener("load",function(e){activeSection.target.imageURL=e.target.result,refreshControls(refreshables.TABS_BIT)}),t.readAsDataURL(e)}}function t(e,t){B.src=t,currentSongTitle=e,document.title="Urmusic - "+e,B.play(),R.classList.contains("masked")||R.classList.add("masked")}function n(e){if(e.type.match("audio.*")){var n=new FileReader;n.addEventListener("load",function(n){t(e.name.substr(0,e.name.lastIndexOf(".")),n.target.result)}),n.readAsDataURL(e)}}function a(t){for(var a,i,s=0;s<t.length;s++)t[s].type.match("image.*")?a=t[s]:t[s].type.match("audio.*")?i=t[s]:t[s].name.endsWith(".urm")&&loadFilePreset(t[s],s===t.length-1);a&&e(a),i&&n(i)}function i(e,t,n){return t<0||t>=e.length?n:e[t]}function s(e,t,n,a){return(1-a)*(1-a)*e+2*(1-a)*a*t+a*a*n}function o(e,t,n,a){if(n){var o=Math.floor(t+.5);return s(lerp(i(e,o-1,a),i(e,o,a),.5),i(e,o,a),lerp(i(e,o,a),i(e,o+1,a),.5),t-o+.5)}var r=Math.floor(t),l=Math.ceil(t),c=i(e,r,a),d=i(e,l,a);return lerp(c,d,t-r)}function r(e,t){var n=t.minDecibels.value;return Math.max(o(S,lerp(t.freqStart.value,t.freqEnd.value,e)*S.length,t.quadratic,n)-n,0)/(t.maxDecibels.value-n)}function l(){if(E.smoothingTimeConstant=settings.smoothingTimeConstant.value,L.smoothingTimeConstant=settings.advanced.lowpassSmooth,C.smoothingTimeConstant=settings.advanced.highpassSmooth,!S&&(S=new Float32Array(E.frequencyBinCount),B.paused))for(var e=0;e<S.length;e++)S[e]=Number.MIN_SAFE_INTEGER;if(!b&&(b=new Float32Array(E.frequencyBinCount),B.paused))for(var e=0;e<b.length;e++)b[e]=0;if(settings.advanced.enableLowpass&&!x&&(x=new Float32Array(L.frequencyBinCount),B.paused))for(var e=0;e<x.length;e++)x[e]=Number.MIN_SAFE_INTEGER;if(settings.advanced.enableHighpass&&!O&&(O=new Float32Array(C.frequencyBinCount),B.paused))for(var e=0;e<O.length;e++)O[e]=Number.MIN_SAFE_INTEGER;B.paused||(E.getFloatFrequencyData(S),E.getFloatTimeDomainData(b),settings.advanced.enableLowpass&&L.getFloatFrequencyData(x),settings.advanced.enableHighpass&&C.getFloatFrequencyData(O)),I.width==I.clientWidth&&I.height==I.clientHeight||(I.width=I.clientWidth,I.height=I.clientHeight),frameProps.minval=Math.min.apply(Math,S),frameProps.maxval=Math.max.apply(Math,S),frameProps.time=B.currentTime,frameProps.duration=B.duration,frameProps.prettytime=prettyTime(frameProps.time),frameProps.prettyduration=prettyTime(frameProps.duration),frameProps.imgw=0,frameProps.imgh=0,frameProps.imgr=0,settings.advanced.enableLowpass&&(frameProps.maxlowval=Math.max.apply(Math,x),frameProps.minlowval=Math.min.apply(Math,x)),settings.advanced.enableHighpass&&(frameProps.maxhighval=Math.max.apply(Math,O),frameProps.minhighval=Math.min.apply(Math,O)),D(),N(l)}function c(e,t,n){var a=lerp(t.startX,t.endX,n),i=t.yPos;if(t.polar>0){var s=Math.cos((.5*a+.5)*Math.PI*2),o=Math.sin((.5*a+.5)*Math.PI*2),r=s*i,l=o*i;a=lerp(a*e,r*e,t.polar),i=lerp(i*e,l*e,t.polar)}else a*=e,i*=e;return{x:a,y:i}}function d(e,t,n){var a=lerp(t.startX,t.endX,n),i=t.yPos;if(t.polar>0){var s=Math.cos((.5*a+.5)*Math.PI*2),o=Math.sin((.5*a+.5)*Math.PI*2),r=s*i,l=o*i;a=lerp(a*e,r*e,t.polar),i=lerp(i*e,l*e,t.polar)}else a*=e,i*=e;return{x:a,y:i}}function p(e,t,n){var a=Math.pow(r(n,t),t.exponent.value)*t.height.value,i=lerp(t.startX.value,t.endX.value,n),s=t.yPos.value,o=s+t.minHeight.value+a,l=i,c=t.polar.value;if(c>0){var d=Math.cos((.5*i+.5)*Math.PI*2),p=Math.sin((.5*i+.5)*Math.PI*2),u=d*s,h=p*s,m=d*o,f=p*o;i=lerp(i*e,u*e,c),s=lerp(s*e,h*e,c),l=lerp(l*e,m*e,c),o=lerp(o*e,f*e,c)}else i*=e,s*=e,l*=e,o*=e;return{x:i,y:s,ex:l,ey:o}}function u(e,t,n){var a=o(b,n*b.length,t.quadratic,0),i=Math.abs(Math.pow(a,t.exponent.value));a=(a>=0?i:-i)*t.height.value;var s=lerp(t.startX.value,t.endX.value,n),r=t.yPos.value,l=r+a,c=s,d=t.polar.value;if(d>0){var p=Math.cos((.5*s+.5)*Math.PI*2),u=Math.sin((.5*s+.5)*Math.PI*2),h=p*r,m=u*r,f=p*l,g=u*l;s=lerp(s*e,h*e,d),r=lerp(r*e,m*e,d),c=lerp(c*e,f*e,d),l=lerp(l*e,g*e,d)}else s*=e,r*=e,c*=e,l*=e;return{x:s,y:r,ex:c,ey:l}}function h(){navigator.userAgent.indexOf("Firefox/")===-1&&(q.style.marginRight="0px")}function m(){SC.initialize({client_id:U});var e=document.getElementById("soundcloudApp").parentNode.getElementsByClassName("appLinkInput")[0],n=e.parentNode.parentNode;e.addEventListener("change",function(){n.classList.add("loading"),SC.resolve(this.value).then(function(e){var a=new XMLHttpRequest;a.onload=function(a){t(e.title+" (SoundCloud)",a.target.responseURL),n.classList.remove("loading")},a.open("GET",e.stream_url+"?client_id="+U),a.send()},function(){n.classList.remove("loading")})})}function f(e){var t=document.createElement("div"),n=document.createElement("div"),a=document.createElement("input"),i=document.createElement("i");return t.classList.add("musicAppIconContainer"),t.appendChild(e),a.placeholder="Paste a link...",n.appendChild(a),n.appendChild(i),n.classList.add("appLinkForm"),a.classList.add("appLinkInput"),i.classList.add("loadIcon"),new Spinner(X).spin(i),t.appendChild(n),e.addEventListener("click",function(){t.classList.contains("activated")?t.classList.remove("activated"):t.classList.add("activated")}),t}function g(){for(var e=[];0!==_.children.length;)e.push(f(_.removeChild(_.children[0])));for(var t=0,n=e.length;t<n;t++)_.appendChild(e[t]);m()}function v(){if(!I||!M||!F)throw alert("Your browser isn't compatible"),new Error("Couldn't initialize");y=F.createMediaElementSource(B),w=F.createGain(),w.gain.value=.8,E=F.createAnalyser(),E.fftSize=2048,T=F.createBiquadFilter(),T.type="lowpass",L=F.createAnalyser(),L.fftSize=2048,P=F.createBiquadFilter(),P.type="highpass",C=F.createAnalyser(),C.fftSize=2048,I.width=document.body.clientWidth,I.height=document.body.clientHeight,I.addEventListener("dragover",function(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},!1),I.addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),a(e.dataTransfer.files)},!1),localStorage.urmusic_volume?w.gain.value=localStorage.urmusic_volume:localStorage.urmusic_volume=w.gain.value,THEPLAYER.setupPlayer(document.getElementById("itsThePlayer"),{target:B,volume:w.gain.value,onvolumechange:function(e){w.gain.value=e,localStorage.urmusic_volume=e}}),B.crossOrigin="anonymous";var e=document.getElementById("settingsNav"),t=document.getElementById("presetMenuOpenCloseBtn"),n=document.getElementById("settingsPresetsMenu");document.getElementById("hambParent").addEventListener("click",function(a){e.classList.contains("activated")?e.classList.remove("activated"):e.classList.add("activated"),e.classList.contains("activated")||(n.classList.remove("opened"),t.classList.remove("opened"))}),t.addEventListener("click",function(){this.classList.contains("opened")?(this.classList.remove("opened"),n.classList.remove("opened")):(this.classList.add("opened"),n.classList.add("opened"))}),A.addEventListener("click",function(){q.style.marginRight=""}),T.connect(L),P.connect(C),y.connect(w),y.connect(E),y.connect(T),y.connect(P),w.connect(F.destination),settings.advanced.watch("lowpassFreq",function(e,t,n){return T.frequency.value=n,n}),settings.advanced.watch("highpassFreq",function(e,t,n){return P.frequency.value=n,
n}),settings.advanced.lowpassFreq=settings.advanced.lowpassFreq,settings.advanced.highpassFreq=settings.advanced.highpassFreq,g(),console.log(" _    _ ________     __  _ \n| |  | |  ____\\ \\   / / | |\tHey you! This app is highly customizable through the JavaScript\n| |__| | |__   \\ \\_/ /  | |\tconsole too! Have fun, and try not to broke everything :p!\n|  __  |  __|   \\   /   | |\t\n| |  | | |____   | |    |_|\tUrmusic V1.4\n|_|  |_|______|  |_|    (_)\tBy Nasso (https://nasso.github.io/)\n\n"),loadPreset(),l(),h()}var y,w,E,S,b,T,L,x,P,C,O,N=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.oRequestAnimationFrame||function(e){setTimeout(e,1e3/60)},I=document.getElementById("cvs"),M=I.getContext("2d"),F=new AudioContext,U="09bfcfe5b0303000a41b9e9675c0cb47",X={lines:8,length:0,width:14,radius:19,scale:.3,corners:1,color:"#fff",opacity:0,rotate:90,direction:1,speed:1.5,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:!1,hwaccel:!0,position:"absolute"},B=document.getElementById("audioElement"),R=document.getElementById("helpNav"),q=document.getElementById("firefoxIsBetter"),A=q.getElementsByClassName("close")[0],_=document.getElementById("musicApps"),D=function(){function e(){l=r.dataCount.value;var e=r.mode;M.strokeStyle=o.color,M.fillStyle=o.color,M.lineWidth=r.lineWidth.value/100*i,M.shadowColor=o.color,M.shadowBlur=h*s,M.lineCap=r.lineCap.name.toLowerCase(),M.beginPath();for(var t=0;t<l&&(r.drawLast||t!==l-1);t++){var n=t/(l-1),a=p(i,r,n);(e==drawMode.LINES||0==t&&r.clampShapeToZero)&&M.moveTo(a.x,a.y),M.lineTo(a.ex,a.ey),t==l-1&&r.clampShapeToZero&&M.lineTo(a.x,a.y)}if(r.closeShape&&e!==drawMode.FILL&&M.closePath(),e===drawMode.FILL){if(r.smartFill)for(var t=l-1;t>=0;t--)if(r.drawLast||t!==l-1){var n=t/(l-1),d=c(i,r,n);M.lineTo(d.x,d.y)}M.fill()}else M.moveTo(0,0),M.stroke()}function t(){l=r.dataCount.value;var e=r.mode;M.strokeStyle=o.color,M.fillStyle=o.color,M.lineWidth=r.lineWidth.value/100*i,M.shadowColor=o.color,M.shadowBlur=h*s,M.lineCap=r.lineCap.name.toLowerCase(),M.lineJoin=r.lineJoin.name.toLowerCase(),M.beginPath();for(var t=0;t<l&&(r.drawLast||t!==l-1);t++){var n=t/(l-1),a=u(i,r,n);(e==drawMode.LINES||0==t&&r.clampShapeToZero)&&M.moveTo(a.x,a.y),M.lineTo(a.ex,a.ey),t==l-1&&r.clampShapeToZero&&M.lineTo(a.x,a.y)}if(r.closeShape&&e!==drawMode.FILL&&M.closePath(),e===drawMode.FILL){if(r.smartFill)for(var t=l-1;t>=0;t--)if(r.drawLast||t!==l-1){var n=t/(l-1),c=d(i,r,n);M.lineTo(c.x,c.y)}M.fill()}else M.moveTo(0,0),M.stroke()}function n(){if(r.imageReady){M.shadowColor=o.color,M.shadowBlur=h*s,M.scale(1,-1);var e=r.image,t=r.imageBorderRadius.value*i;0!==t?(M.roundRect(-i/2,-i/2,i,i,t),M.clip(),M.drawImage(e,-i/2,-i/2,i,i)):M.drawImage(e,-i/2,-i/2,i,i)}}function a(){var e="";r.text&&""!==(e=r.text.value)&&(M.shadowColor=o.color,M.shadowBlur=h*s,M.fillStyle=o.color,M.font=r.fontStyle+" "+r.fontSize.value*i+"px "+r.fontFamily,M.textAlign=r.textAlign.name.toLowerCase(),M.textBaseline=r.textBaseline.name.toLowerCase(),M.scale(1,-1),M.fillText(e,0,0))}var i=0,s=0,o=null,r=null,l=32,h=0;return function(){aspect=I.width/I.height,i=Math.min(I.width,I.height),frameProps.csize=i,M.clearRect(0,0,I.width,I.height),M.fillStyle=settings.backgroundColor,M.fillRect(0,0,I.width,I.height),M.save(),M.translate(I.width/2,I.height/2),M.scale(.5,-.5),s=settings.globalScale.value,M.scale(s,s),M.translate(settings.globalOffsetX.value*i,settings.globalOffsetY.value*i),M.rotate(settings.globalRotation.value*Math.PI/180);for(var l=0;l<settings.sections.length;l++)o=settings.sections[l],r=o.target,o.visible&&(o.type===sectionType.IMAGE&&r.imageReady?(frameProps.imgw=r.image.width,frameProps.imgh=r.image.height,frameProps.imgr=frameProps.imgw/frameProps.imgh):frameProps.imgw=frameProps.imgh=frameProps.imgr=0,h=o.glowness.value,M.save(),M.translate(o.posX.value*i,o.posY.value*i),M.rotate(o.rotation.value*Math.PI/180),M.scale(o.scaleX.value,o.scaleY.value),M.globalAlpha=o.opacity.value,o.type===sectionType.FREQ?e():o.type===sectionType.TIME_DOM?t():o.type===sectionType.IMAGE?n():o.type===sectionType.TEXT&&a(),M.restore());M.restore()}}();v()});